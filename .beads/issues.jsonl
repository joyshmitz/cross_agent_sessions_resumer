{"id":"bd-1a2","title":"EPIC: Provider Writers (Export to Native Format)","description":"Implement writers that convert from canonical IR into each provider's native session format.\n\nThis is the novel part of casr: CASS reads sessions, but casr must write provider-plausible sessions that the target tool can resume.\n\nTarget outputs:\n- Claude Code: JSONL at `~/.claude/projects/<hash>/<session-id>.jsonl`\n- Codex: JSONL at `~/.codex/sessions/YYYY/MM/DD/rollout-N.jsonl`\n- Gemini CLI: JSON at `~/.gemini/tmp/<hash>/chats/session-<id>.json`\n\nCritical architecture constraint:\n- Reuse CASS reader knowledge by vendoring/adapting relevant logic into casr.\n- Do NOT introduce a runtime dependency on CASS.\n\nWriter quality bar:\n1. Output files must be accepted by provider resume flows in real smoke tests.\n2. Preserve maximal fidelity from canonical IR, including provider-specific extras when possible.\n3. Use atomic write semantics and deterministic serialization choices where practical.\n4. Include explicit rollback behavior on verification failure (no partial broken sessions left behind).\n5. Emit rich trace diagnostics explaining field mapping decisions and generated IDs/paths.\n\n## Success Criteria\n\n- Each core provider writer passes:\n  - same-provider read-back verification,\n  - golden-output conformance suite,\n  - (opt-in) real-provider acceptance smoke harness.\n- Writer output is deterministic where expected (excluding generated ids/timestamps with documented normalization rules).\n- `--force` overwrite is always recoverable via backups and is well logged.","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:38:02.674259111Z","created_by":"ubuntu","updated_at":"2026-02-09T06:00:00.512491489Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","writers"],"dependencies":[{"issue_id":"bd-1a2","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-08T20:46:04.697242211Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2","depends_on_id":"bd-2zw.7","type":"blocks","created_at":"2026-02-08T22:00:29.457808322Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1a2.1","title":"Implement Claude Code session writer","description":"Implement Provider::write_session() for Claude Code in src/providers/claude_code.rs.\n\nObjective:\nProduce Claude-native session artifacts that are resume-acceptable and structurally close to real Claude Code outputs, using findings from bd-1a2.4.\n\nOutput target:\n~/.claude/projects/<project-dir-key>/<new-session-id>.jsonl\n\nWriter requirements:\n1. Compute project directory key from workspace path using the verified algorithm from bd-1a2.4.\n2. Generate a new session ID and ensure filename/session fields are consistent with Claude resume behavior.\n3. Emit user/assistant events in Claude-compatible JSONL structure:\n   - first user entry carries cwd/sessionId/gitBranch when required,\n   - subsequent entries use minimal native shape,\n   - assistant entries include model metadata when available.\n4. Serialize timestamps to provider-acceptable ISO-8601.\n5. Preserve high-value provider extras when safe (without violating native format expectations).\n6. Use atomic write semantics (bd-ikb.3) including conflict + backup behavior.\n7. Ensure output path creation is robust when directories are missing.\n\nValidation requirements:\n- Must pass same-provider read-back verification (casr Claude reader parses written output).\n- Must pass golden-output conformance tests against redacted-real Claude fixture expectations (structure + required fields).\n- Must pass opt-in real-provider acceptance smoke when Claude CLI is installed (bd-24z.13).\n\nAcceptance criteria:\n- Written Claude session can be resumed using the documented Claude resume command with generated ID.\n- Project directory key and session ID behavior match documented research findings.\n- Reader round-trip and golden-output conformance tests pass.\n- Conflict/force/backup behavior is covered by tests and logged clearly.","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-08T20:41:17.382537275Z","created_by":"ubuntu","updated_at":"2026-02-08T22:07:30.363345777Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["claude-code","writers"],"dependencies":[{"issue_id":"bd-1a2.1","depends_on_id":"bd-1a2","type":"parent-child","created_at":"2026-02-08T21:49:09.027967289Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.1","depends_on_id":"bd-1a2.4","type":"blocks","created_at":"2026-02-08T20:44:39.696760305Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.1","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:39.547792525Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.1","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T20:44:39.622855484Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.1","depends_on_id":"bd-ikb.3","type":"blocks","created_at":"2026-02-08T21:03:52.094561565Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1a2.2","title":"Implement Codex session writer","description":"Implement Provider::write_session() for Codex in src/providers/codex.rs.\n\nObjective:\nGenerate Codex-compatible rollout artifacts that are accepted by Codex resume flows, based on bd-1a2.5 research outcomes.\n\nOutput target:\n~/.codex/sessions/YYYY/MM/DD/rollout-N.jsonl (or documented equivalent if research proves a stricter requirement).\n\nWriter requirements:\n1. Determine session file placement and external session identifier rules using bd-1a2.5 findings (do not assume path-only or UUID-only without evidence).\n2. Emit Codex-native event envelopes in correct sequence:\n   - session_meta (workspace/cwd context)\n   - response_item events for conversation turns\n   - event_msg token_count entries when token usage is available\n3. Preserve role/content fidelity and map canonical assistant/user roles correctly.\n4. Preserve key provider extras when compatible with Codex schema.\n5. Serialize timestamps to provider-acceptable format.\n6. Use atomic write semantics (bd-ikb.3), including conflict detection and backup handling.\n\nValidation requirements:\n- Must pass same-provider read-back verification with casr Codex reader.\n- Must pass golden-output conformance tests against redacted-real Codex fixture expectations.\n- Must pass opt-in real-provider acceptance smoke when Codex CLI is installed (bd-24z.13).\n\nAcceptance criteria:\n- Output file/event structure matches documented Codex format expectations.\n- Resume identifier behavior is implemented per verified research (and documented).\n- Reader round-trip + golden-output conformance tests pass.\n- Conflict/force/backup behavior is validated in tests.","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-08T20:41:27.646685290Z","created_by":"ubuntu","updated_at":"2026-02-08T22:07:39.030118544Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["codex","writers"],"dependencies":[{"issue_id":"bd-1a2.2","depends_on_id":"bd-1a2","type":"parent-child","created_at":"2026-02-08T21:49:08.826700675Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.2","depends_on_id":"bd-1a2.5","type":"blocks","created_at":"2026-02-08T20:44:39.918521376Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.2","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:39.770791052Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.2","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T20:44:39.843932795Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.2","depends_on_id":"bd-ikb.3","type":"blocks","created_at":"2026-02-08T21:03:52.172838396Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1a2.3","title":"Implement Gemini CLI session writer","description":"Implement Provider::write_session() for Gemini CLI in src/providers/gemini.rs.\n\nObjective:\nGenerate Gemini session JSON artifacts that are accepted by Gemini session discovery/resume flows, based on bd-1a2.6 findings.\n\nOutput target:\n~/.gemini/tmp/<project-hash-or-equivalent>/chats/session-<id>.json\n\nWriter requirements:\n1. Determine project hash / directory derivation and session ID conventions from verified research.\n2. Emit Gemini-native top-level structure (sessionId, projectHash-equivalent, start/lastUpdated, messages array).\n3. Map assistant turns to Gemini message type \"model\" (not \"assistant\") and preserve user/model ordering.\n4. Preserve grounding/citation metadata and multipart content blocks when present.\n5. Serialize timestamps in accepted format and maintain chronological coherence.\n6. Create required directory hierarchy when absent.\n7. Use atomic write semantics (bd-ikb.3), including conflict and backup behavior.\n\nValidation requirements:\n- Must pass same-provider read-back verification with casr Gemini reader.\n- Must pass golden-output conformance tests against redacted-real Gemini fixture expectations.\n- Must pass opt-in real-provider acceptance smoke when Gemini CLI is installed (bd-24z.13).\n\nAcceptance criteria:\n- Written session is discoverable/resumable by Gemini according to documented research.\n- Hash/directory/session-ID behavior follows verified rules.\n- Reader round-trip + golden-output conformance tests pass.\n- Conflict/force/backup behavior is covered by tests.","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-08T20:41:37.524099794Z","created_by":"ubuntu","updated_at":"2026-02-08T22:07:50.126050613Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["gemini","writers"],"dependencies":[{"issue_id":"bd-1a2.3","depends_on_id":"bd-1a2","type":"parent-child","created_at":"2026-02-08T21:49:08.625121927Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.3","depends_on_id":"bd-1a2.6","type":"blocks","created_at":"2026-02-08T20:44:40.159898412Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.3","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:39.993120897Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.3","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T20:44:40.080470904Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.3","depends_on_id":"bd-ikb.3","type":"blocks","created_at":"2026-02-08T21:03:52.250813912Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1a2.4","title":"Reverse-engineer Claude Code session directory naming","description":"Investigate and document how Claude Code derives the project directory key under ~/.claude/projects/ and how resume identity maps to files.\n\nResearch method:\n1. Correlate existing ~/.claude/projects/* directories with known workspace paths.\n2. Inspect Claude CLI/package behavior and source (if available).\n3. Cross-check with CASS Claude connector assumptions and explicitly note matches/differences.\n4. Validate with synthetic write + real Claude resume attempt.\n\nRequired outputs:\n- Verified algorithm: workspace path -> project directory key.\n- Verified session filename/ID behavior used by resume.\n- Determination of whether additional manifests/index files are required for resume discovery.\n- Rust helper implementation in casr with tests against multiple real samples.\n- Documentation in src/providers/claude_code.rs and docs/cass-porting-notes.md.\n\nAcceptance criteria:\n- Algorithm validated against at least 3 real workspace/project-dir pairs.\n- Helper function reproduces all sampled keys deterministically.\n- Resume ID/file mapping is documented with concrete examples.\n- Any divergence from CASS assumptions is explicitly documented.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:43:50.559354910Z","created_by":"ubuntu","updated_at":"2026-02-09T06:10:55.862303901Z","closed_at":"2026-02-09T06:10:55.862285587Z","close_reason":"Reverse-engineered and implemented project_dir_key(): all non-alphanumeric chars → hyphens. Validated against real ~/.claude/projects/ directories. Tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["claude-code","research","writers"],"dependencies":[{"issue_id":"bd-1a2.4","depends_on_id":"bd-1a2","type":"parent-child","created_at":"2026-02-08T21:49:08.023460308Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.4","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:44:45.104491128Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1a2.5","title":"Reverse-engineer Codex session resume mechanism","description":"Investigate and document Codex resume resolution semantics: how `codex resume <id>` maps IDs to session files and which file fields are mandatory.\n\nResearch method:\n1. Inspect Codex CLI help/behavior and source where available.\n2. Probe ~/.codex/sessions structure across multiple real sessions.\n3. Create controlled synthetic session files and test acceptance/rejection.\n4. Compare findings against CASS Codex connector assumptions and document deltas.\n\nRequired outputs:\n- Verified lookup algorithm (path-based, embedded ID-based, index-based, or hybrid).\n- Minimum required JSONL/JSON fields for resume acceptance.\n- Confirmation of any checksum/signature/index requirements.\n- Concrete mapping examples from observed session IDs to file paths.\n- Documentation in src/providers/codex.rs and docs/cass-porting-notes.md.\n\nAcceptance criteria:\n- Resume lookup behavior is validated empirically with real/synthetic cases.\n- Mandatory vs optional fields are clearly listed.\n- Research findings directly inform writer implementation rules in bd-1a2.2.\n- Any divergence from CASS assumptions is explicitly documented.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:44:03.752649488Z","created_by":"ubuntu","updated_at":"2026-02-09T06:10:55.959813778Z","closed_at":"2026-02-09T06:10:55.959787269Z","close_reason":"Reverse-engineered Codex session resume: ULID session IDs, rollout-TIMESTAMP-ID.jsonl naming, session_meta payload.id, date-hierarchy directories. rollout_path() helper + owns_session with 3-tier lookup (path, filename suffix, body). Tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["codex","research","writers"],"dependencies":[{"issue_id":"bd-1a2.5","depends_on_id":"bd-1a2","type":"parent-child","created_at":"2026-02-08T21:49:07.824387932Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.5","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:44:45.181214064Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1a2.6","title":"Reverse-engineer Gemini CLI session resume mechanism","description":"Investigate and document Gemini session discovery/resume semantics, including session ID mapping, hash directory derivation, and minimum acceptable file shape.\n\nResearch method:\n1. Inspect Gemini CLI commands/help and source where available.\n2. Examine ~/.gemini/tmp/*/chats layout and any related state/index files.\n3. Create synthetic sessions and validate acceptance/rejection paths.\n4. Compare findings with CASS Gemini connector assumptions and document deltas.\n\nRequired outputs:\n- Verified resume/discovery mechanism (explicit resume command vs implicit discovery behavior).\n- Verified relationship between sessionId, filename, and hash-directory placement.\n- Minimum required JSON fields and any required sibling artifacts.\n- Documentation in src/providers/gemini.rs and docs/cass-porting-notes.md.\n\nAcceptance criteria:\n- Gemini acceptance behavior is validated with reproducible experiments.\n- Hash/ID/path rules are documented with concrete examples.\n- Research findings directly inform writer implementation rules in bd-1a2.3.\n- Any divergence from CASS assumptions is explicitly documented.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:44:14.313844502Z","created_by":"ubuntu","updated_at":"2026-02-09T06:10:56.055019514Z","closed_at":"2026-02-09T06:10:56.054999035Z","close_reason":"Reverse-engineered Gemini session resume: SHA256(workspace) project hash, session-TIMESTAMP-UUIDprefix.json naming, sessionId in body. project_hash() and session_filename() helpers. Tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gemini","research","writers"],"dependencies":[{"issue_id":"bd-1a2.6","depends_on_id":"bd-1a2","type":"parent-child","created_at":"2026-02-08T21:49:07.625103399Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1a2.6","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:44:45.258155228Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1kg","title":"EPIC: CLI Interface & UX","description":"Implement the casr CLI using clap.\n\nPrimary usage pattern: `casr <target-agent> resume <session-id>`.\n\nTarget agents:\n- `cc` (Claude Code)\n- `cod` (Codex)\n- `gmi` (Gemini CLI)\n\nAdditional subcommands:\n- `casr list` (list sessions across providers)\n- `casr info <session-id>` (inspect a session without converting)\n- `casr providers` (detection status + evidence)\n- `casr completions <shell>`\n\nThe CLI must:\n- auto-detect the source provider from the session ID (with explicit ambiguity errors)\n- show clear progress + actionable failures\n- report success with the exact resume command for the target provider\n- support `--json` output for automation\n\nUses color with TTY detection; colors must be disabled automatically for `--json` and non-TTY output.\n\n## Success Criteria\n\n- Primary `resume` flow is fast, safe (atomic writes + backup), and self-verifying.\n- `list/info/providers` are useful for discovery and debugging without conversion.\n- All commands support `--json` with stable schemas and contract tests.\n- Error messages include remediation hints (install, `--source`, `--force`, etc.).","status":"open","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:38:09.242303221Z","created_by":"ubuntu","updated_at":"2026-02-08T22:52:21.915103800Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","ux"],"dependencies":[{"issue_id":"bd-1kg","depends_on_id":"bd-3my","type":"blocks","created_at":"2026-02-08T20:46:05.135990126Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg","depends_on_id":"bd-ikb","type":"blocks","created_at":"2026-02-08T20:46:05.056337066Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1kg.1","title":"Implement CLI argument parsing with clap","description":"Implement the clap CLI in `src/main.rs`. Use clap derive macros.\n\n## Commands\n\nUsage patterns:\n\n- `casr <target> resume <session-id>` (primary)\n- `casr list [--provider <slug>] [--workspace <path>] [--limit <n>] [--sort <field>]`\n- `casr info <session-id>`\n- `casr providers`\n- `casr completions <bash|zsh|fish>`\n- `casr --version`\n- `casr --help`\n\nWhere `<target>` is one of: `cc` (Claude Code), `cod` (Codex), `gmi` (Gemini CLI).\n\n## Global Flags\n\n- `--dry-run` : show what would happen without writing.\n- `--force` : overwrite existing target session if it exists (creates backups).\n- `--json` : machine-readable JSON output (no ANSI color, stable field names).\n- `--verbose` : enable debug-level logs.\n- `--trace` : enable trace-level logs.\n- `--source <alias_or_path>` : pin source provider alias (`cc|cod|gmi`) OR a direct native session file path.\n- `--enrich` : opt-in enrichment messages (bd-ikb.4).\n\nLogging note:\n- `--verbose`/`--trace` must configure the tracing subscriber filter directly (do not claim to \"set RUST_LOG\" at runtime).\n- If `RUST_LOG` is already set, `--verbose`/`--trace` should override only for the `casr` target (documented precedence).\n\n## Acceptance Criteria\n\n- clap surface matches the README command reference.\n- `--source` accepts either a known alias or a path; invalid values produce actionable usage errors.\n- `--json` mode is supported across commands and disables color automatically.\n- `--verbose` and `--trace` are wired to tracing subscriber filtering (bd-2zw.6).","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-08T20:41:48.436160082Z","created_by":"ubuntu","updated_at":"2026-02-08T22:50:09.536261776Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli"],"dependencies":[{"issue_id":"bd-1kg.1","depends_on_id":"bd-1kg","type":"parent-child","created_at":"2026-02-08T21:49:08.421300610Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg.1","depends_on_id":"bd-3my.1","type":"blocks","created_at":"2026-02-08T20:44:50.554982969Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1kg.2","title":"Implement resume command output and UX","description":"Implement the user-facing output for `casr <target> resume <session-id>`. This is what the user sees when they run the tool.\n\nSuccess output example:\n\n  ✓ Found session 019c3eae-94c3-7d73-9b2a-9edb18f1563b\n    Source: Codex (codex)\n    Workspace: /data/projects/myapp\n    Messages: 47 (23 user, 24 assistant)\n    Duration: 2h 15m\n\n  ✓ Converted to Claude Code format\n    Written to: ~/.claude/projects/abc123/new-session-id.jsonl\n    Verified: read-back check passed ✓\n\n  Resume with:\n    claude --resume new-session-id\n\nBackup notification (when `--force` was used and an existing session was backed up):\n\n  ⚠ Existing session backed up to ~/.claude/projects/abc123/old-session-id.jsonl.bak\n\nError output examples:\n\n  ✗ Session ID 'bad-id' not found\n    Searched: Claude Code (roots: 2, files: 23), Codex (roots: 1, files: 156), Gemini (roots: 1, files: 12)\n    Tip: Run `casr list` to see available sessions\n    Tip: Use `--source <provider>` if you know the origin\n\n  ✗ Target provider not writable\n    Provider: Claude Code\n    Evidence: ~/.claude/projects is read-only\n    Tip: Fix permissions or set `CLAUDE_HOME` to a writable location\n\n  ✗ Session already exists in target\n    Existing: ~/.claude/projects/abc123/existing-session-id.jsonl (47 messages, 2h ago)\n    Use `--force` to overwrite (creates .bak), or resume existing:\n      claude --resume existing-session-id\n\n  ✗ Write verification failed (this is a bug in casr)\n    The written file could not be read back. Please report this with `--trace --json` output.\n\nUX requirements:\n- Use `colored` crate for colors (TTY-aware).\n- Show progress for large sessions.\n- In `--json` mode, output structured JSON instead of human text.\n\n## Acceptance Criteria\n\n- Success output includes: source provider, workspace, message counts, written paths, and resume command.\n- Warnings (validation warnings, binary-missing warnings) are visible in human output and present in `--json` result.\n- Errors are actionable and include remediation hints.\n- Output formatting is deterministic enough for e2e tests (bd-24z.5/bd-24z.6).","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:42:00.316169403Z","created_by":"ubuntu","updated_at":"2026-02-08T22:53:19.564726546Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","ux"],"dependencies":[{"issue_id":"bd-1kg.2","depends_on_id":"bd-1kg","type":"parent-child","created_at":"2026-02-08T21:49:13.674318857Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg.2","depends_on_id":"bd-1kg.1","type":"blocks","created_at":"2026-02-08T20:44:50.623081923Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg.2","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T21:04:16.265126132Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1kg.3","title":"Implement list and info subcommands","description":"Implement the `casr list` and `casr info <session-id>` subcommands.\n\n## `casr list`\n\nScan all readable providers and display a table of sessions:\n\n  Provider     Session ID                              Workspace                    Date          Messages\n  claude-code  40f2cb68-fed7-4cee-83de-2b63ba9b7813   /data/projects/myapp         2026-02-07    47\n  codex        019c3eae-94c3-7d73-9b2a-9edb18f1563b   /data/projects/other         2026-02-06    156\n  gemini       3bdd5aeb-a260-4e20-94a3-3fa5a0b8f7b8   /data/projects/webapp        2026-02-05    247\n\nOptional filters:\n- `--provider <slug>` (only one provider)\n- `--workspace <path>` (filter by workspace)\n- `--limit <n>`\n- `--sort <field>` (date/messages/provider)\n\n## `casr info <session-id>`\n\nDisplay details without converting:\n\n  Session: 019c3eae-94c3-7d73-9b2a-9edb18f1563b\n  Provider: Codex\n  Workspace: /data/projects/other\n  Started: 2026-02-06 14:30:00 UTC\n  Ended: 2026-02-06 16:45:00 UTC\n  Duration: 2h 15m\n  Messages: 156 (78 user, 78 assistant)\n  Model: o3-pro\n  Source: ~/.codex/sessions/2026/02/06/rollout-1.jsonl\n\n  First message: \"Help me implement the auth module...\"\n  Last message: \"All tests passing. Ready to deploy.\"\n\nIn `--json` mode, output structured JSON. These commands read from disk without converting.\n\n## Acceptance Criteria\n\n- `list` and `info` operate on providers with readable roots (binary not required).\n- `list` supports filtering/sorting/limit as documented.\n- `info` uses bd-3my.2 to resolve session ids and surfaces `AmbiguousSessionId` when applicable.\n- `--json` output is schema-tested (bd-24z.11).","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-08T20:42:12.866806438Z","created_by":"ubuntu","updated_at":"2026-02-08T22:53:34.978169849Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli"],"dependencies":[{"issue_id":"bd-1kg.3","depends_on_id":"bd-1kg","type":"parent-child","created_at":"2026-02-08T21:49:15.105850276Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg.3","depends_on_id":"bd-1kg.1","type":"blocks","created_at":"2026-02-08T20:44:50.768209616Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg.3","depends_on_id":"bd-3my.2","type":"blocks","created_at":"2026-02-08T20:44:50.838055419Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1kg.4","title":"Add shell completion generation (bash/zsh/fish)","description":"Use `clap_complete` to generate shell completions for bash, zsh, and fish. Add a `casr completions <shell>` subcommand that writes completion scripts to stdout.\n\nUsage example:\n\n```bash\neval \"$(casr completions bash)\"\n```\n\nImplementation notes:\n- `clap_complete` integrates with clap derive: add dependency and generator wiring.\n- Completions must include all subcommands, flags, and arguments.\n- Provider aliases (`cc`, `cod`, `gmi`) must be offered as completions for `<target>`.\n\n## Acceptance Criteria\n\n- `casr completions bash|zsh|fish` prints valid completion scripts.\n- Completion scripts include all global flags and subcommands.\n- Provider alias completions are correct and tested in a CLI integration test.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-08T21:05:21.522469158Z","created_by":"ubuntu","updated_at":"2026-02-08T22:53:41.397131084Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","ux"],"dependencies":[{"issue_id":"bd-1kg.4","depends_on_id":"bd-1kg","type":"parent-child","created_at":"2026-02-08T21:49:14.498347652Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1kg.4","depends_on_id":"bd-1kg.1","type":"blocks","created_at":"2026-02-08T21:05:25.201245070Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x","title":"EPIC: Provider Readers (Import from Native Format)","description":"Implement readers that parse each provider's native session format into the canonical IR. Each reader takes a session file path and produces a `CanonicalSession`.\n\nScope:\n- Claude Code (`~/.claude/projects/*.jsonl/.json/.claude`)\n- Codex (`~/.codex/sessions/**/rollout-*.jsonl` + legacy JSON)\n- Gemini CLI (`~/.gemini/tmp/<hash>/chats/session-*.json`)\n\nPort and adapt connector parsing logic from CASS (`/dp/coding_agent_session_search/src/connectors/`) for behavior parity.\n\nCritical architecture constraint:\n- casr MUST vendor/copy/adapt relevant CASS logic directly into casr source.\n- casr MUST NOT depend on CASS as an external runtime/library dependency.\n\nReader acceptance requirements:\n1. Handle all known format variants (JSONL vs JSON, string vs block-array content, mixed timestamp formats).\n2. Preserve provider-specific non-canonical fields in `session.metadata` and `message.extra`.\n3. Be permissive on malformed lines/events (skip with diagnostics where safe) and fail only on unrecoverable session corruption.\n4. Produce deterministic output ordering and stable parsing behavior for tests.\n5. Emit trace-level diagnostics at key decisions (role mapping, timestamp fallback path, workspace inference path).\n\nThis epic is the import half of the conversion pipeline.\n\n## Success Criteria\n\n- Core readers pass fixture tests (synthetic + redacted-real) and parity suite.\n- Readers are resilient to malformed inputs and produce actionable warnings.\n- Reader outputs preserve high-value provider-specific raw fields in `metadata`/`extra` for writer fidelity.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:37:54.035149598Z","created_by":"ubuntu","updated_at":"2026-02-09T05:58:34.791994780Z","closed_at":"2026-02-09T05:58:34.791969082Z","close_reason":"Core readers complete (Claude Code, Codex, Gemini CLI). bd-20x.4 (additional providers) is P3 future work, not blocking.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","readers"],"dependencies":[{"issue_id":"bd-20x","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-08T20:46:04.615515810Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x","depends_on_id":"bd-2zw.7","type":"blocks","created_at":"2026-02-08T22:00:29.378282025Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.1","title":"Implement Claude Code session reader","description":"Implement Provider::read_session() for Claude Code in src/providers/claude_code.rs by porting/adapting CASS claude_code connector behavior.\n\nFormat scope:\n- Scan Claude session files under ~/.claude/projects/* (JSONL primary; JSON/.claude variants where present).\n- Parse user/assistant conversational events while skipping non-conversational event types.\n- Resolve role/content/timestamp using robust fallback rules from CASS helpers.\n- Extract workspace/session metadata (cwd, sessionId, gitBranch) and preserve raw event data in extra.\n- Derive external session identity from filename/path conventions used by Claude files.\n\nRobustness requirements:\n- Tolerate malformed lines/files without crashing; keep valid messages.\n- Skip empty/whitespace content messages.\n- Preserve ordering and stable message indexing after filtering.\n- Handle large files safely and log skip decisions.\n\nParity requirements:\n- Behavior should align with CASS porting notes unless an intentional divergence is documented.\n- Any divergence must be captured in docs/cass-porting-notes.md with rationale.\n\nAcceptance criteria:\n- Reader passes fixture tests (synthetic + redacted-real Claude fixtures).\n- Reader passes CASS parity regression tests for Claude fixtures.\n- Metadata/workspace/title extraction behavior is covered by unit tests with detailed failure logs.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:40:30.002441671Z","created_by":"ubuntu","updated_at":"2026-02-09T05:53:53.314938750Z","closed_at":"2026-02-09T05:53:53.314919744Z","close_reason":"Implemented Claude Code JSONL reader with: conversational message filtering (user/assistant only), metadata extraction (sessionId, cwd, gitBranch, version), content flattening, tool call/result extraction, timestamp tracking, model name counting. Handles malformed lines gracefully. Clippy+fmt clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["claude-code","readers"],"dependencies":[{"issue_id":"bd-20x.1","depends_on_id":"bd-20x","type":"parent-child","created_at":"2026-02-08T21:49:09.632577598Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.1","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:33.903049475Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.1","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T20:44:33.982596617Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.2","title":"Implement Codex session reader","description":"Implement Provider::read_session() for Codex in src/providers/codex.rs by porting/adapting CASS codex connector behavior.\n\nFormat scope:\n- Scan rollout files under ~/.codex/sessions (JSONL modern + legacy JSON format support).\n- JSONL parsing:\n  - session_meta: extract workspace/cwd context\n  - response_item: parse primary user/assistant turns\n  - event_msg user_message/agent_reasoning/token_count handling with CASS-compatible rules\n- Legacy JSON parsing: {session, items} fallback handling.\n\nCritical behavior to preserve:\n- Token_count events attach retroactively to latest non-reasoning assistant turn.\n- Content flattening covers string and block-array representations.\n- External ID derivation preserves relative rollout path identity.\n- Unknown/non-conversational events are ignored safely.\n\nRobustness requirements:\n- Malformed lines are tolerated; valid messages still parsed.\n- Empty/whitespace content turns are skipped.\n- Message ordering/indexing remains stable after filtering.\n\nParity requirements:\n- Match CASS codex connector behavior unless intentional divergence is documented.\n- Record divergences in docs/cass-porting-notes.md.\n\nAcceptance criteria:\n- Reader passes synthetic + redacted-real Codex fixture tests.\n- Reader passes CASS parity regression tests for Codex fixtures.\n- Token usage attachment and legacy-format handling are explicitly unit-tested with detailed logs.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:40:41.242903383Z","created_by":"ubuntu","updated_at":"2026-02-09T05:58:11.187557755Z","closed_at":"2026-02-09T05:58:11.187534391Z","close_reason":"Implemented Codex JSONL+legacy JSON reader. Modern JSONL: session_meta, response_item, event_msg (user_message/agent_reasoning) parsing. Legacy JSON: session.cwd + items array. Tool call/result extraction, timestamp tracking, graceful malformed-line handling. Clippy+fmt clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["codex","readers"],"dependencies":[{"issue_id":"bd-20x.2","depends_on_id":"bd-20x","type":"parent-child","created_at":"2026-02-08T21:49:09.428446201Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.2","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:34.059624423Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.2","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T20:44:34.135701911Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.3","title":"Implement Gemini CLI session reader","description":"Implement Provider::read_session() for Gemini in src/providers/gemini.rs by porting/adapting CASS gemini connector behavior.\n\nFormat scope:\n- Scan session-*.json files in ~/.gemini/tmp/*/chats/ only.\n- Parse top-level session metadata (sessionId, projectHash, start/lastUpdated).\n- Parse messages array with Gemini type semantics (user/model -> user/assistant canonical roles).\n- Preserve grounding/citation metadata in message extras.\n\nWorkspace inference requirements:\n- Use CASS-derived extraction cascade from message content (AGENTS header, working-directory pattern, /data/projects heuristic).\n- Normalize Unix/Windows path forms robustly.\n- Fall back to hash-directory parent when content extraction fails.\n\nRobustness requirements:\n- Tolerate malformed files/records without crashing.\n- Skip empty/whitespace message content.\n- Maintain stable message order and indexing.\n\nParity requirements:\n- Match CASS gemini connector behavior unless intentional divergence is documented.\n- Record divergences in docs/cass-porting-notes.md.\n\nAcceptance criteria:\n- Reader passes synthetic + redacted-real Gemini fixture tests.\n- Reader passes CASS parity regression tests for Gemini fixtures.\n- Workspace inference edge cases (quoted paths, Windows paths, truncated project paths) are covered by unit tests with detailed logs.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:40:52.277115849Z","created_by":"ubuntu","updated_at":"2026-02-09T05:58:14.654942020Z","closed_at":"2026-02-09T05:58:14.654905222Z","close_reason":"Implemented Gemini JSON reader. Parses session-level fields (sessionId, startTime, lastUpdated, projectHash), messages array with type=user/model, content flattening, workspace extraction from message content heuristics. Clippy+fmt clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gemini","readers"],"dependencies":[{"issue_id":"bd-20x.3","depends_on_id":"bd-20x","type":"parent-child","created_at":"2026-02-08T21:49:09.227223379Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.3","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:34.214528815Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.3","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T20:44:34.294529466Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4","title":"Add support for additional providers (Cline, Amp, Aider, Cursor)","description":"After the initial three providers (Claude Code, Codex, Gemini) are complete and stable, extend casr to additional providers where formats are known or can be reverse-engineered.\n\nCandidate providers (priority order):\n1. Cursor (VS Code globalStorage)\n2. Cline (VS Code globalStorage)\n3. Aider (Markdown history format)\n4. Amp (VS Code + local share paths)\n5. OpenCode (SQLite-backed sessions)\n\nArchitecture and dependency policy:\n- Implement each as a native casr provider module via the same `Provider` trait.\n- Port/adapt CASS insights by vendoring logic as needed.\n- Do NOT add runtime dependency on CASS.\n\nQuality bar per provider:\n- Reader implementation with fixture coverage.\n- Writer implementation that produces provider-plausible artifacts.\n- `owns_session` discovery support.\n- Resume command wiring and CLI integration.\n- Round-trip + e2e coverage with detailed logs.\n- Document known lossy conversions and unsupported fields.\n\nExecution strategy:\n- Ship providers incrementally behind clear task boundaries and tests.\n- Do not merge a provider without passing provider-specific reader/writer + e2e smoke coverage.\n\n## Success Criteria\n\n- Each added provider has:\n  - detection + ownership lookup\n  - reader + writer\n  - resume command wiring\n  - fixtures + unit tests + round-trip tests + e2e coverage\n- Known lossy fields are explicitly documented and asserted in tests.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-08T20:45:40.707719677Z","created_by":"ubuntu","updated_at":"2026-02-08T22:56:21.796394043Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["future","readers"],"dependencies":[{"issue_id":"bd-20x.4","depends_on_id":"bd-20x","type":"parent-child","created_at":"2026-02-08T21:49:15.308089591Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4","depends_on_id":"bd-20x.1","type":"blocks","created_at":"2026-02-08T20:45:57.923127573Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4","depends_on_id":"bd-20x.2","type":"blocks","created_at":"2026-02-08T20:45:58.003187886Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4","depends_on_id":"bd-20x.3","type":"blocks","created_at":"2026-02-08T20:45:58.078153512Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4.1","title":"Implement Cursor provider adapter (reader, writer, discovery, resume wiring)","description":"Implement a full Cursor provider adapter in casr via the `Provider` trait.\n\nScope:\n- Detection: locate Cursor storage roots (VS Code `globalStorage` patterns) with env override support.\n- Discovery: `owns_session(session_id)` fast-path lookup + fallback where needed.\n- Reader: parse native Cursor session format into `CanonicalSession` with maximal fidelity.\n- Writer: export `CanonicalSession` back into a Cursor-plausible session artifact.\n- Resume command generation + CLI integration.\n- Provider-specific fixtures + unit tests with detailed logs on parse/write failures.\n\n## Acceptance Criteria\n\n- Cursor provider passes:\n  - reader fixture tests,\n  - writer read-back tests,\n  - round-trip matrix paths involving Cursor (as added),\n  - e2e coverage in `scripts/e2e_test.sh` for Cursor paths.\n- Provider preserves Cursor-specific metadata where possible and documents lossy fields.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-08T22:01:39.641690798Z","created_by":"ubuntu","updated_at":"2026-02-08T22:56:52.866073046Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cursor","future","readers","writers"],"dependencies":[{"issue_id":"bd-20x.4.1","depends_on_id":"bd-20x.4","type":"parent-child","created_at":"2026-02-08T22:01:39.641690798Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.1","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T22:56:31.729456723Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4.2","title":"Implement Cline provider adapter (reader, writer, discovery, resume wiring)","description":"Implement a full Cline provider adapter in casr via the `Provider` trait.\n\nScope:\n- Detection: locate Cline storage roots (VS Code `globalStorage` patterns) with env override support.\n- Discovery: `owns_session(session_id)` fast-path lookup + fallback.\n- Reader: parse native Cline sessions into `CanonicalSession`.\n- Writer: export canonical sessions into Cline-plausible artifacts.\n- Resume command support + CLI wiring.\n- Provider-specific fixtures + tests with detailed logging.\n\n## Acceptance Criteria\n\n- Cline provider passes reader fixture tests, writer read-back tests, and round-trip paths.\n- Detection and ownership are deterministic and debuggable from logs.\n- Lossy fields are documented and asserted in tests.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-08T22:01:39.723249861Z","created_by":"ubuntu","updated_at":"2026-02-08T22:56:59.662906196Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cline","future","readers","writers"],"dependencies":[{"issue_id":"bd-20x.4.2","depends_on_id":"bd-20x.4","type":"parent-child","created_at":"2026-02-08T22:01:39.723249861Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.2","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T22:56:34.583467419Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4.3","title":"Implement Aider provider adapter (Markdown history import/export + discovery)","description":"Implement Aider provider support.\n\nScope:\n- Discovery: locate Aider history files (Markdown transcripts) and determine a stable session id scheme.\n- Reader: robust Markdown transcript parsing into canonical IR (including edge-case markdown, code fences, interleaved tool output sections).\n- Writer: export canonical sessions back into a provider-compatible transcript (as close to Aider-native as feasible).\n- Tests: fixtures for multiple transcript variants + e2e compatibility tests.\n\n## Acceptance Criteria\n\n- Reader handles real-world markdown edge cases without panicking and produces deterministic canonical output.\n- Writer produces Aider-compatible transcript artifacts and passes read-back compatibility tests.\n- Fixtures + tests document any lossy conversions explicitly.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-08T22:01:39.802863140Z","created_by":"ubuntu","updated_at":"2026-02-08T22:57:07.349211152Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["aider","future","readers","writers"],"dependencies":[{"issue_id":"bd-20x.4.3","depends_on_id":"bd-20x.4","type":"parent-child","created_at":"2026-02-08T22:01:39.802863140Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.3","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T22:56:37.260788020Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4.4","title":"Implement Amp provider adapter (VS Code + local-share session formats)","description":"Implement Amp provider support across known storage locations.\n\nScope:\n- Discovery probes across known Amp storage layouts (VS Code + local-share paths where applicable).\n- Reader/writer behavior via the `Provider` trait.\n- Tests covering multi-location resolution, conflicts, and deterministic ownership lookup.\n\n## Acceptance Criteria\n\n- Detection covers all documented Amp storage roots with clear evidence.\n- Reader and writer pass fixture + read-back tests.\n- Discovery ambiguity is handled deterministically (error + remediation).","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-08T22:01:39.882576356Z","created_by":"ubuntu","updated_at":"2026-02-08T22:57:12.535682954Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["amp","future","readers","writers"],"dependencies":[{"issue_id":"bd-20x.4.4","depends_on_id":"bd-20x.4","type":"parent-child","created_at":"2026-02-08T22:01:39.882576356Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.4","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T22:56:40.666204767Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4.5","title":"Implement OpenCode provider adapter (SQLite-backed session support)","description":"Implement OpenCode provider support for SQLite-backed sessions.\n\nScope:\n- Detection: locate OpenCode SQLite DB(s) and identify schema/version.\n- Reader: safe read paths into canonical IR (no destructive queries).\n- Writer: write semantics for creating new sessions (migration-safe, versioned where needed).\n- Discovery: session lookup by id with deterministic mapping.\n- Tests: fixtures with minimal SQLite DB snapshots + migration/version fallback behavior.\n\n## Acceptance Criteria\n\n- Reader can parse sessions from a fixture DB and preserves provider-specific metadata.\n- Writer produces new sessions without corrupting existing DB state.\n- Tests cover schema/version changes with clear diagnostics.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-08T22:01:39.962903102Z","created_by":"ubuntu","updated_at":"2026-02-08T22:57:18.627277244Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["future","opencode","readers","writers"],"dependencies":[{"issue_id":"bd-20x.4.5","depends_on_id":"bd-20x.4","type":"parent-child","created_at":"2026-02-08T22:01:39.962903102Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.5","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T22:56:44.238849451Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-20x.4.6","title":"Add shared fixture and fidelity test matrix for additional providers","description":"Create a shared fixture corpus and fidelity matrix tests for all newly added providers.\n\nScope:\n- Add provider-native fixtures for each new provider (synthetic + redacted-real where possible).\n- Extend round-trip and conformance tests to include the new providers.\n- Ensure e2e coverage with detailed logs and artifact dumps on failure.\n- Document unsupported or lossy conversions per provider with explicit assertions.\n\n## Acceptance Criteria\n\n- Each new provider ships with a fixture set + reader tests + writer tests.\n- Round-trip matrix includes new provider paths with explicit lossiness documentation.\n- e2e script covers at least one conversion path per new provider.\n- Failures publish artifacts (generated output, diffs, logs) sufficient for debugging.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","updated_at":"2026-02-08T22:57:26.489733575Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["future","providers","testing"],"dependencies":[{"issue_id":"bd-20x.4.6","depends_on_id":"bd-20x.4","type":"parent-child","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.6","depends_on_id":"bd-20x.4.1","type":"blocks","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.6","depends_on_id":"bd-20x.4.2","type":"blocks","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.6","depends_on_id":"bd-20x.4.3","type":"blocks","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.6","depends_on_id":"bd-20x.4.4","type":"blocks","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-20x.4.6","depends_on_id":"bd-20x.4.5","type":"blocks","created_at":"2026-02-08T22:01:40.042886594Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z","title":"EPIC: Testing & Validation","description":"Comprehensive testing and validation for casr.\n\nRequired coverage dimensions:\n1. Unit tests for each reader and writer.\n2. Round-trip invariants (`read->canonical->write->read`) including per-provider and cross-provider paths.\n3. Integration tests using realistic fixture corpora for all supported providers.\n4. Property-based tests for normalization and parse/serialize resilience.\n5. End-to-end CLI tests and shell e2e scripts with detailed structured logging.\n6. Real-provider smoke checks (opt-in) that validate resume acceptance with installed provider CLIs.\n7. JSON contract tests for `--json` output schemas and error envelopes.\n8. Failure-injection tests for atomic-write + rollback semantics.\n9. CASS parity regression tests for reader behavior on canonical fixture sets.\n\nNon-negotiable logging/debuggability requirements:\n- Every failing test must surface enough context to debug without reproducing manually.\n- e2e scripts must output command, expected/actual, artifact paths, and pass/fail summary.\n- `VERBOSE`/`TRACE` modes must be test-covered and produce inspectable diagnostics.\n\nKey invariant:\nFor each provider `P`, `read_P(write_P(canonical))` should be equivalent to canonical (modulo documented provider-specific lossy fields).\n\n## Success Criteria\n\n- CI runs unit, round-trip, contracts, conformance, parity, e2e, and perf suites with actionable artifacts.\n- A failing test provides enough logs/artifacts to root-cause without re-running locally.\n- Writer correctness is validated by both reader round-trip and golden-output conformance (symmetric-bug protection).","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-08T20:38:22.669687933Z","created_by":"ubuntu","updated_at":"2026-02-08T22:52:32.305529965Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["testing"],"dependencies":[{"issue_id":"bd-24z","depends_on_id":"bd-1kg","type":"blocks","created_at":"2026-02-08T20:46:05.290967374Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z","depends_on_id":"bd-ikb","type":"blocks","created_at":"2026-02-08T20:46:05.213287848Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.1","title":"Create test fixtures for each provider format","description":"Create a high-fidelity fixture corpus under tests/fixtures/ for provider readers, writers, round-trip tests, and e2e harnesses.\n\nFixture strategy (MANDATORY):\n1. Synthetic fixtures: minimal and edge-case sessions crafted by hand.\n2. Redacted-real fixtures: sanitized snapshots derived from real provider session files so writer/reader behavior is anchored to real-world structures.\n\nProvider-native fixture sets:\n- Claude Code: simple, complex (content arrays/tool events), missing-workspace, unicode.\n- Codex: modern JSONL, legacy JSON, token_count events, reasoning events.\n- Gemini: simple, grounding/citations, missing-workspace inference.\n- Cross-cutting edge fixtures: empty/whitespace content, null/missing timestamps, long message bodies, single-sided conversations.\n\nCorpus rules:\n- Keep provider fixture files strictly provider-native JSON/JSONL (no inline comment lines).\n- Put fixture intent and caveats in sidecar notes files and a manifest (e.g., fixtures_manifest.json).\n- For each fixture, include expected canonical summary output used by tests (message count/order/roles, workspace, metadata expectations, known lossy fields).\n- Include at least one fixture per provider that exercises malformed-line tolerance without breaking parse of valid remaining messages.\n\nLogging/debuggability requirements:\n- Tests consuming fixtures must print fixture ID/path when failing.\n- Mismatch reports must include expected vs actual canonical summary artifact paths.\n\nAcceptance criteria:\n- Fixture corpus includes both synthetic and redacted-real sets for Claude Code, Codex, and Gemini.\n- Every fixture has a sidecar expected canonical summary and documented intent.\n- No provider-native fixture relies on non-native comment syntax.\n- Fixture IDs are stable and referenced by reader/writer/round-trip/e2e tests.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:42:56.641976155Z","created_by":"ubuntu","updated_at":"2026-02-08T22:07:18.036068694Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["testing"],"dependencies":[{"issue_id":"bd-24z.1","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:13.061662605Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.1","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:45:07.867670879Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.10","title":"Implement CASS parity regression suite for provider readers","description":"Implement a regression suite that asserts casr reader behavior stays aligned with CASS-derived parsing expectations for Claude Code, Codex, and Gemini.\n\nScope:\n1. Build a shared fixture corpus (provider-native files + expected canonical summaries).\n2. For each fixture, assert casr parsing output matches expected canonical fields:\n   - message count/order/roles/content\n   - timestamps normalization\n   - workspace inference behavior\n   - provider-specific metadata capture (`extra`/`metadata`)\n3. Track expected divergences explicitly in a small allowlist file with rationale.\n4. Emit detailed mismatch logs showing field-level diffs.\n\nAcceptance criteria:\n- [ ] parity suite runs in CI\n- [ ] at least one fixture per known edge-case variant per provider\n- [ ] mismatches produce machine-readable diff artifact and readable summary\n- [ ] any intentional deviation from CASS behavior is documented in `docs/cass-porting-notes.md`","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T21:59:57.897690928Z","created_by":"ubuntu","updated_at":"2026-02-08T22:00:29.531230801Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["parity","readers","testing"],"dependencies":[{"issue_id":"bd-24z.10","depends_on_id":"bd-20x.1","type":"blocks","created_at":"2026-02-08T21:59:57.897690928Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.10","depends_on_id":"bd-20x.2","type":"blocks","created_at":"2026-02-08T21:59:57.897690928Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.10","depends_on_id":"bd-20x.3","type":"blocks","created_at":"2026-02-08T21:59:57.897690928Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.10","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:59:57.897690928Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.10","depends_on_id":"bd-24z.1","type":"blocks","created_at":"2026-02-08T21:59:57.897690928Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.10","depends_on_id":"bd-2zw.7","type":"blocks","created_at":"2026-02-08T22:00:29.531197619Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.11","title":"Implement JSON contract/schema tests for all --json CLI outputs","description":"Define and test the machine-readable contract for all CLI `--json` outputs.\n\nScope:\n1. Create JSON schema files for:\n   - conversion result (success and failure)\n   - list output\n   - info output\n   - providers output\n   - shared error envelope\n2. Add contract tests that validate live CLI output against schemas.\n3. Ensure backward-compatible field stability within this project (no silent key churn).\n4. Add redaction-safe logging in test failures (show failing JSON path + value snippet).\n\nAcceptance criteria:\n- [ ] schema files committed under `docs/json-schema/`\n- [ ] contract tests run in CI and fail on schema drift\n- [ ] `--json` examples in docs match actual output\n- [ ] failure diagnostics point to exact schema path mismatch","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T22:00:06.599281910Z","created_by":"ubuntu","updated_at":"2026-02-08T22:00:06.599281910Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","contracts","testing"],"dependencies":[{"issue_id":"bd-24z.11","depends_on_id":"bd-1kg.1","type":"blocks","created_at":"2026-02-08T22:00:06.599281910Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.11","depends_on_id":"bd-1kg.2","type":"blocks","created_at":"2026-02-08T22:00:06.599281910Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.11","depends_on_id":"bd-1kg.3","type":"blocks","created_at":"2026-02-08T22:00:06.599281910Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.11","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T22:00:06.599281910Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.11","depends_on_id":"bd-2zw.5","type":"blocks","created_at":"2026-02-08T22:00:06.599281910Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.12","title":"Implement failure-injection tests for atomic_write rollback and cleanup","description":"Add targeted failure-injection tests for write safety and rollback behavior.\n\nScope:\n1. Inject failures at each stage of atomic write:\n   - temp file create\n   - write/flush\n   - sync_all\n   - rename\n   - backup creation when `--force`\n2. Assert cleanup guarantees:\n   - no orphan temp files\n   - no partially written target files\n   - backup semantics are correct and recoverable\n3. Add deterministic simulation hooks/mocks so failures are reproducible in CI.\n4. Emit detailed logs with stage, file path, and cleanup action taken.\n\nAcceptance criteria:\n- [ ] failure matrix covers all atomic-write stages\n- [ ] rollback/cleanup invariants are asserted per stage\n- [ ] CI executes these tests reliably\n- [ ] diagnostics clearly identify the failing stage and resulting filesystem state","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T22:00:12.318180634Z","created_by":"ubuntu","updated_at":"2026-02-08T22:00:12.318180634Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["pipeline","resilience","testing"],"dependencies":[{"issue_id":"bd-24z.12","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T22:00:12.318180634Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.12","depends_on_id":"bd-2zw.6","type":"blocks","created_at":"2026-02-08T22:00:12.318180634Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.12","depends_on_id":"bd-ikb.1","type":"blocks","created_at":"2026-02-08T22:00:12.318180634Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.12","depends_on_id":"bd-ikb.3","type":"blocks","created_at":"2026-02-08T22:00:12.318180634Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.13","title":"Implement opt-in real-provider resume acceptance smoke harness","description":"Build an opt-in smoke harness that validates converted sessions are actually accepted by real provider CLIs when available.\n\nScope:\n1. Add script/test harness that runs only when provider binaries and homes are present.\n2. For each core path (CC<->Codex, CC<->Gemini, Codex<->Gemini):\n   - perform conversion,\n   - run provider resume/list command to confirm acceptance,\n   - capture stderr/stdout and exit codes.\n3. Produce detailed logs and artifacts per run:\n   - command transcript,\n   - generated file paths,\n   - provider command output,\n   - PASS/FAIL matrix by conversion path.\n4. Make failures non-silent and actionable (exact provider command and file path shown).\n\nAcceptance criteria:\n- [ ] harness can run locally with one command\n- [ ] skipped-provider behavior is explicit and reported\n- [ ] successful runs produce a per-path PASS matrix\n- [ ] failing runs include enough detail to reproduce manually","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T22:00:19.936304445Z","created_by":"ubuntu","updated_at":"2026-02-08T22:09:16.780221968Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","smoke","testing"],"dependencies":[{"issue_id":"bd-24z.13","depends_on_id":"bd-1a2.4","type":"blocks","created_at":"2026-02-08T22:09:16.615390453Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.13","depends_on_id":"bd-1a2.5","type":"blocks","created_at":"2026-02-08T22:09:16.695179449Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.13","depends_on_id":"bd-1a2.6","type":"blocks","created_at":"2026-02-08T22:09:16.780174339Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.13","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T22:00:19.936304445Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.13","depends_on_id":"bd-24z.6","type":"blocks","created_at":"2026-02-08T22:00:19.936304445Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.13","depends_on_id":"bd-2zw.6","type":"blocks","created_at":"2026-02-08T22:00:19.936304445Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.13","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T22:00:19.936304445Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.14","title":"Implement writer golden-output conformance suite","description":"Add a dedicated writer conformance suite that validates generated provider files against golden, redacted-real fixture expectations.\n\nWhy this is required:\nReader<->writer round-trip alone can hide symmetric bugs (writer and reader both wrong in the same way). This suite prevents that by checking writer output against external golden expectations.\n\nScope:\n1. For each provider writer (Claude/Codex/Gemini), generate output from canonical fixtures.\n2. Compare generated artifacts to provider-specific golden expectations:\n   - required field presence/shape\n   - event ordering constraints\n   - filename/path conventions\n   - timestamp format validity\n   - provider-specific metadata presence/absence constraints\n3. Use tolerant normalization where IDs/timestamps are expected to differ (with explicit normalization rules).\n4. Emit human-readable and machine-readable diffs on mismatch.\n\nLogging/artifacts:\n- Save generated output, normalized output, and diff artifacts per test case.\n- Print fixture ID, provider, and exact mismatch path.\n\nAcceptance criteria:\n- Conformance tests cover all three initial providers.\n- Symmetric-bug protection is demonstrated (at least one negative fixture/assertion case).\n- CI runs conformance suite and publishes mismatch artifacts on failure.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T22:09:04.195576364Z","created_by":"ubuntu","updated_at":"2026-02-08T22:09:04.195576364Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["conformance","testing","writers"],"dependencies":[{"issue_id":"bd-24z.14","depends_on_id":"bd-1a2.1","type":"blocks","created_at":"2026-02-08T22:09:04.195576364Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.14","depends_on_id":"bd-1a2.2","type":"blocks","created_at":"2026-02-08T22:09:04.195576364Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.14","depends_on_id":"bd-1a2.3","type":"blocks","created_at":"2026-02-08T22:09:04.195576364Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.14","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T22:09:04.195576364Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.14","depends_on_id":"bd-24z.1","type":"blocks","created_at":"2026-02-08T22:09:04.195576364Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.15","title":"Implement discovery/reader scalability regression suite","description":"Add performance and scalability regression tests for discovery + parsing on large session corpora.\n\nScope:\n1. Generate deterministic synthetic corpora with high file counts (e.g., 1k/5k/10k mixed provider files).\n2. Benchmark key hot paths:\n   - provider detection and root scanning\n   - owns_session lookup fast-path/fallback\n   - reader parse throughput per provider\n3. Define budget thresholds for CI perf-regression job (with clear pass/fail criteria).\n4. Capture perf diagnostics:\n   - files scanned\n   - parse count\n   - elapsed ms per stage\n   - memory usage proxy metrics where practical\n\nRequirements:\n- Tests must be deterministic and runnable in CI without accessing real user homes.\n- Results must be emitted in machine-readable form for trend tracking.\n- Regressions should produce actionable output pinpointing the slow stage.\n\nAcceptance criteria:\n- Performance suite covers discovery and all three initial readers.\n- CI enforces baseline budgets with documented thresholds.\n- Failure logs include enough context to reproduce regression locally.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","updated_at":"2026-02-08T22:09:11.764282117Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["discovery","performance","testing"],"dependencies":[{"issue_id":"bd-24z.15","depends_on_id":"bd-20x.1","type":"blocks","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.15","depends_on_id":"bd-20x.2","type":"blocks","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.15","depends_on_id":"bd-20x.3","type":"blocks","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.15","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.15","depends_on_id":"bd-2zw.6","type":"blocks","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.15","depends_on_id":"bd-3my.2","type":"blocks","created_at":"2026-02-08T22:09:11.764282117Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.2","title":"Implement unit tests for each reader","description":"Write comprehensive unit tests for each provider's `read_session()` implementation. Tests live in each provider file as `#[cfg(test)] mod tests`.\n\nFor each reader, test:\n1. Happy path: read a well-formed fixture; verify canonical fields.\n2. Message roles: user/assistant/tool/system mapping.\n3. Content formats: string content, array-of-blocks content, null content.\n4. Timestamps: ISO-8601, epoch seconds, epoch millis, missing timestamps.\n5. Workspace extraction/inference.\n6. Session ID extraction.\n7. Edge cases: empty file, single message, very large session, malformed lines (skip with warning, do not crash).\n8. Provider-specific raw fields are preserved in `message.extra` / `session.metadata`.\n9. Title extraction.\n\nLogging requirements:\n- On assertion failures, print the full canonical session as pretty JSON.\n- For each parsed message, log: index, role, content_length, timestamp, has_extra.\n- Failures must identify fixture id/path and the failing message index.\n\nUse fixtures from bd-24z.1 plus targeted inline JSON/JSONL strings.\n\n## Acceptance Criteria\n\n- Reader unit tests cover happy paths and real-world edge cases for each core provider.\n- Failures provide enough logs to debug parse issues without additional instrumentation.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:43:07.096421501Z","created_by":"ubuntu","updated_at":"2026-02-08T22:54:47.892744871Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["readers","testing"],"dependencies":[{"issue_id":"bd-24z.2","depends_on_id":"bd-20x.1","type":"blocks","created_at":"2026-02-08T20:45:08.015176752Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.2","depends_on_id":"bd-20x.2","type":"blocks","created_at":"2026-02-08T20:45:08.100778988Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.2","depends_on_id":"bd-20x.3","type":"blocks","created_at":"2026-02-08T20:45:08.170845805Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.2","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:12.862787578Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.2","depends_on_id":"bd-24z.1","type":"blocks","created_at":"2026-02-08T20:45:07.942465095Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.3","title":"Implement unit tests for each writer","description":"Write comprehensive unit tests for each provider's `write_session()` implementation.\n\n## Primary Strategy: Reader↔Writer Compatibility\n\nFor each provider writer:\n1. Create a `CanonicalSession` programmatically (known values).\n2. Write it using the provider's `write_session()` into a temp provider home.\n3. Read it back using the SAME provider's `read_session()`.\n4. Compare the original canonical input with the re-read version.\n5. Verify message count/order/roles/content/timestamps match (modulo documented lossy fields).\n\nThis proves the writer produces files that casr can read back (and is a strong proxy for provider plausibility).\n\n## Secondary Tests\n\n- Output placement: file is written under the correct provider directory structure.\n- JSON validity: JSONL lines are valid JSON; JSON files parse.\n- Required fields: writer outputs contain provider-required keys/shapes (conformance suite is the authority).\n- Timestamp serialization: verify timestamps are in the provider-accepted format.\n  - Do NOT assume ISO-8601 for every provider; use per-provider golden expectations + reverse-engineering findings.\n- Role mapping rules (assistant/user/tool/system) are correct per provider schema.\n- Directory creation: parents created as needed.\n- Idempotency: writing the same session twice with `--force` is deterministic after applying normalization rules for generated ids/timestamps.\n- Conflict detection: error when target exists without `--force`.\n\n## Logging Requirements\n\n- Log output file path(s) and byte counts.\n- On failure, dump written file contents (with line numbers for JSONL).\n- Use descriptive `assert_eq!` messages that identify provider + field + line/index.\n\nUse temp dirs (`tempfile`) for isolation; never touch real provider directories.\n\n## Acceptance Criteria\n\n- Writer unit tests exist for Claude/Codex/Gemini and are parallel-safe.\n- Writer tests validate both read-back compatibility and provider-specific output shape.\n- Failures include full artifacts/logs sufficient for debugging.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:43:16.156134049Z","created_by":"ubuntu","updated_at":"2026-02-08T22:55:01.572509681Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["testing","writers"],"dependencies":[{"issue_id":"bd-24z.3","depends_on_id":"bd-1a2.1","type":"blocks","created_at":"2026-02-08T20:45:08.330742642Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.3","depends_on_id":"bd-1a2.2","type":"blocks","created_at":"2026-02-08T20:45:08.404474629Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.3","depends_on_id":"bd-1a2.3","type":"blocks","created_at":"2026-02-08T20:45:08.478050154Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.3","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:12.656407922Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.3","depends_on_id":"bd-24z.1","type":"blocks","created_at":"2026-02-08T20:45:08.248529169Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.4","title":"Implement round-trip fidelity tests","description":"Write round-trip tests verifying: `read_P(write_P(read_Q(source))) ≈ read_Q(source)` for all provider pairs.\n\nTest all 6 conversion paths:\n1. CC→Cod, 2. CC→Gmi, 3. Cod→CC, 4. Cod→Gmi, 5. Gmi→CC, 6. Gmi→Cod.\n\nFor each path:\n- read source fixture → canonical → write to target format (temp dir) → read back → compare.\n\nFidelity matrix (expected preservation per field):\n\n| Field              | CC→Cod | CC→Gmi | Cod→CC | Cod→Gmi | Gmi→CC | Gmi→Cod |\n|--------------------|--------|--------|--------|---------|--------|---------|\n| message_count      | EXACT  | EXACT  | EXACT  | EXACT   | EXACT  | EXACT   |\n| message_roles      | EXACT  | EXACT  | EXACT  | EXACT   | EXACT  | EXACT   |\n| message_content    | EXACT  | EXACT  | EXACT  | EXACT   | EXACT  | EXACT   |\n| timestamps (±1s)   | EXACT  | EXACT  | EXACT  | EXACT   | EXACT  | EXACT   |\n| workspace          | EXACT  | BEST*  | EXACT  | BEST*   | BEST*  | BEST*   |\n| session_id         | NEW    | NEW    | NEW    | NEW     | NEW    | NEW     |\n| model_name         | EXACT  | EXACT  | EXACT  | EXACT   | EXACT  | EXACT   |\n| git_branch (CC)    | LOST   | LOST   | N/A    | N/A     | N/A    | N/A     |\n| token_usage (Cod)  | N/A    | N/A    | LOST   | LOST    | N/A    | N/A     |\n| citations (Gmi)    | N/A    | N/A    | N/A    | N/A     | LOST   | LOST    |\n\nEXACT = must match. NEW = new id generated (verify valid format). BEST* = best-effort. LOST = expected loss (document explicitly in test comments). N/A = not present in source.\n\nLogging requirements:\n- For each path, log: source_provider, target_provider, message_count.\n- On mismatch, show side-by-side message diffs (index, role, content prefix, timestamp delta).\n- Print a summary table for all 6 paths.\n\n## Acceptance Criteria\n\n- All 6 conversion paths are covered and deterministic.\n- Mismatch output is high-signal and includes enough context to debug.\n- Expected lossy fields are explicitly documented and asserted.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:43:27.012902401Z","created_by":"ubuntu","updated_at":"2026-02-08T22:55:15.935070070Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["roundtrip","testing"],"dependencies":[{"issue_id":"bd-24z.4","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:12.456863693Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.4","depends_on_id":"bd-24z.2","type":"blocks","created_at":"2026-02-08T20:45:08.554581191Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.4","depends_on_id":"bd-24z.3","type":"blocks","created_at":"2026-02-08T20:45:08.635942869Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.5","title":"Implement end-to-end CLI integration tests","description":"Write end-to-end tests that exercise the full casr CLI using `assert_cmd` and `predicates`.\n\nCore scenarios:\n1. `casr --version` outputs build/version metadata.\n2. `casr --help` outputs usage.\n3. `casr providers` handles installed and none-installed cases gracefully.\n4. `casr list` with mocked provider dirs returns expected rows.\n5. `casr info <session-id>` returns expected fields.\n6. `casr <target> resume <session-id>` succeeds on fixture-backed conversion.\n7. `--dry-run` does not write output files.\n8. bad session id returns actionable error.\n9. `--json` output is valid and schema-conformant.\n10. invalid command/args returns usage hints.\n\nLogging/debug requirements:\n- Capture and print stdout/stderr for each failing case.\n- For conversion failures, print source fixture path, provider roots, and generated target path.\n- Include per-test command transcript in failure output.\n- Support `RUST_LOG=casr=debug/trace` in test mode and verify logs appear when requested.\n\nIsolation requirements:\n- Use temp dirs + `CLAUDE_HOME`/`CODEX_HOME`/`GEMINI_HOME` overrides.\n- Never touch real user provider directories.\n- Tests must be deterministic and parallel-safe.\n\n## Acceptance Criteria\n\n- CLI integration tests cover success paths and common failures.\n- `--json` output is validated against schemas (bd-24z.11).\n- Failing tests print enough output to debug without manual re-run.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-08T20:43:37.500870042Z","created_by":"ubuntu","updated_at":"2026-02-08T22:55:25.724404220Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","testing"],"dependencies":[{"issue_id":"bd-24z.5","depends_on_id":"bd-1kg.2","type":"blocks","created_at":"2026-02-08T20:45:08.712923748Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.5","depends_on_id":"bd-1kg.3","type":"blocks","created_at":"2026-02-08T20:45:08.792299409Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.5","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:14.903725867Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.5","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T21:07:57.873758911Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.6","title":"Write e2e test shell script with detailed logging","description":"Create `scripts/e2e_test.sh`: a comprehensive end-to-end test script that exercises the full casr CLI from the outside.\n\nThe script should:\n1. Set up temp directories for each provider's session storage.\n2. Create synthetic but realistic test session files in each provider's native format.\n3. Run each conversion path (6 total: CC→Cod, CC→Gmi, Cod→CC, Cod→Gmi, Gmi→CC, Gmi→Cod).\n4. Verify each conversion succeeds (exit code 0).\n5. Verify output files exist and are valid JSON/JSONL.\n6. Verify key fields are present (session id, messages, workspace when available).\n7. Test error cases: bad session id, missing provider roots, conflict detection.\n8. Test `--dry-run` (no writes).\n9. Test `--force` (backup created + recoverable).\n10. Test `--json` output.\n11. Test `--verbose` and `--trace` (verify logs appear).\n12. Test `--source` for explicit provider specification.\n\nLogging requirements:\n- Clear header for each test case: `=== TEST: Convert Codex→Claude Code ===`\n- Show the exact command being run.\n- Show PASS/FAIL for each assertion.\n- On failure: show expected vs actual, dump relevant file contents, show casr stderr, and print artifact paths.\n- End summary: passed/failed/total with timings.\n- Exit non-zero if any test failed.\n- Support `VERBOSE=1` to show full output even on pass.\n\nUse env var overrides (`CLAUDE_HOME`, `CODEX_HOME`, `GEMINI_HOME`) to redirect provider paths to temp dirs. Clean up temp dirs on exit (trap handler).\n\nThe script should be runnable with just `bash scripts/e2e_test.sh` (dependencies: bash + jq).\n\n## Acceptance Criteria\n\n- Script exercises the full conversion matrix + key error cases.\n- Logging is detailed enough to debug failures without re-running interactively.\n- Script is deterministic and safe (never touches real provider directories).","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T21:04:52.770603591Z","created_by":"ubuntu","updated_at":"2026-02-08T22:54:25.394900348Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","logging","testing"],"dependencies":[{"issue_id":"bd-24z.6","depends_on_id":"bd-1kg.2","type":"blocks","created_at":"2026-02-08T21:04:58.918165621Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.6","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:11.846150047Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.6","depends_on_id":"bd-24z.5","type":"blocks","created_at":"2026-02-08T22:00:29.607642807Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.6","depends_on_id":"bd-2zw.6","type":"blocks","created_at":"2026-02-08T21:26:12.196589288Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.6","depends_on_id":"bd-ikb.5","type":"blocks","created_at":"2026-02-08T21:04:58.826346683Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.7","title":"Implement unit tests for canonical model helpers","description":"Write unit tests for the helper functions in `src/model.rs`: `flatten_content`, `parse_timestamp`, `normalize_role`, `truncate_title`, `reindex_messages`.\n\nThese helpers handle the messiest part of format conversion and must be exhaustively tested.\n\nTests for `flatten_content()`:\n- string input -> returns the string\n- array of `{type:\"text\", text:\"...\"}` -> concatenates all text blocks\n- array of `{type:\"input_text\", text:\"...\"}` -> concatenates text blocks\n- `{type:\"tool_use\", name:\"Bash\", input:{description:\"run tests\"}}` -> stable tool marker text\n- mixed arrays containing text + tool_use + strings\n- object without `type` but with `text`\n- array of strings\n- empty array / null / numbers / booleans\n- nested arrays (if supported)\n\nTests for `parse_timestamp()`:\n- ISO-8601 with Z and fractional\n- ISO-8601 with timezone offsets\n- epoch seconds vs millis heuristic (including numeric strings)\n- float strings\n- invalid/null/object/array inputs return None\n\nTests for `normalize_role()`:\n- user/assistant/model/agent/tool/system mappings (case-insensitive)\n- unknown roles map to Other(role)\n\nTests for `truncate_title()`:\n- first line extraction\n- trimming\n- truncation with `...`\n- empty/whitespace -> empty\n\nTests for `reindex_messages()`:\n- gaps are removed\n- empty vec no-op\n\nLogging:\n- Each test logs input and expected output.\n- On failure, show raw serde_json::Value input alongside parsed result.\n\n## Acceptance Criteria\n\n- Helper tests cover edge cases that commonly appear in provider formats.\n- Tests are deterministic and produce high-signal failure output.\n- No helper panics on malformed inputs.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T21:06:45.681532791Z","created_by":"ubuntu","updated_at":"2026-02-08T22:54:36.365570517Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","model","testing"],"dependencies":[{"issue_id":"bd-24z.7","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:11.446203512Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.7","depends_on_id":"bd-2rl.1","type":"blocks","created_at":"2026-02-08T22:00:29.682215189Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.7","depends_on_id":"bd-2rl.3","type":"blocks","created_at":"2026-02-08T21:06:49.976646174Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.8","title":"Implement unit tests for provider detection and session discovery","description":"Write unit tests for provider detection + session discovery (`ProviderRegistry` + bd-3my.2 resolver).\n\n## ProviderRegistry Tests\n\n1. `new()` creates registry with all 3 providers.\n2. `find_by_slug(\"claude-code\")` returns Some; unknown slug returns None.\n3. `find_by_alias(\"cc\"|\"cod\"|\"gmi\")` returns correct provider.\n4. `detect_all()` returns a `ProviderStatus` for each provider with evidence-rich detection.\n5. `providers_for_read()` includes providers with readable roots even if binaries are missing.\n6. `providers_for_write()` includes providers with writable/creatable roots even if binaries are missing.\n\n## Session Ownership Resolver Tests (bd-3my.2)\n\n1. With a synthetic session file in a temp Claude Code directory, resolution finds (Claude, path).\n2. With a synthetic session file in a temp Codex directory, resolution finds (Codex, path).\n3. With a synthetic session file in a temp Gemini directory, resolution finds (Gemini, path).\n4. Non-existent session ID returns `SessionNotFound` with provider/root/file-count diagnostics.\n5. Ambiguous session ID present in multiple providers returns `AmbiguousSessionId` with all candidate providers/paths.\n6. `--source <alias>` narrows search to one provider.\n7. `--source <path>` bypasses discovery and resolves directly.\n\nUse env var overrides (`CLAUDE_HOME`, `CODEX_HOME`, `GEMINI_HOME`) to redirect to temp dirs.\n\n## Logging/Debug Requirements\n\n- Log each directory scanned, each fast-path checked, and the final decision.\n- On failure, show directory listings for temp roots and the resolver trace (decision path).\n\n## Acceptance Criteria\n\n- Tests cover unique match, no match, ambiguous match, alias hint, and path hint.\n- Tests cover detection evidence and can_read/can_write behavior.\n- Failures are debuggable from test output alone.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T21:07:01.074925884Z","created_by":"ubuntu","updated_at":"2026-02-08T22:49:36.032824709Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["discovery","testing"],"dependencies":[{"issue_id":"bd-24z.8","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:11.246807410Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.8","depends_on_id":"bd-24z.1","type":"blocks","created_at":"2026-02-08T21:07:05.811582071Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.8","depends_on_id":"bd-3my.1","type":"blocks","created_at":"2026-02-08T21:07:05.656268912Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.8","depends_on_id":"bd-3my.2","type":"blocks","created_at":"2026-02-08T21:07:05.733538517Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-24z.9","title":"Implement unit tests for conversion pipeline with mock providers","description":"Write unit tests for the `ConversionPipeline` using mock providers. Since the pipeline is generic over the `Provider` trait, we can test it with in-memory mock providers that do not touch the filesystem.\n\n## Mock Provider Harness\n\nCreate a `MockProvider` that implements `Provider`:\n- `detect()` returns configurable `DetectionResult` (binary present/missing; roots readable/writable).\n- `owns_session(id)` returns Some(path) for a predefined set.\n- `read_session(path)` returns a hardcoded `CanonicalSession` or a controlled error.\n- `write_session(session, opts)` records writes and returns `WrittenSession` with fake paths + optional backups.\n- `resume_command(id)` returns a formatted string.\n\nAlso add a mock resolver hook or deterministic registry layout so bd-3my.2 behaviors (unique/ambiguous/not-found) can be exercised without touching disk.\n\n## Pipeline Tests\n\nHappy paths:\n1. Convert from MockA to MockB succeeds; `write_session()` called with expected canonical session.\n2. Dry run: `dry_run=true` does not call `write_session()`.\n3. Same-provider shortcut: source==target returns early with resume command and no writes.\n\nDiscovery/error paths:\n4. Session not found: returns `SessionNotFound` with diagnostics.\n5. Ambiguous session id: returns `AmbiguousSessionId` and never reads/writes.\n6. Target not writable: returns `ProviderUnavailable` (or equivalent) and never writes.\n7. Target binary missing but writable: conversion succeeds and emits a WARNING in result.\n8. Source hint by alias narrows provider search.\n9. Source hint by path bypasses discovery.\n\nValidation coverage (MUST cover ALL checks from bd-ikb.2):\n10. Empty session -> `ValidationError`.\n11. User-only -> `ValidationError`.\n12. Assistant-only -> `ValidationError`.\n13. No workspace -> warning (pipeline continues).\n14. No timestamps -> warning.\n15. Consecutive same-role messages -> warning.\n16. Unmatched tool_result.call_id -> info (verbose/trace only).\n\nVerify/rollback:\n17. Verify-after-write success path.\n18. Verify failure triggers rollback:\n    - if backups were created, restore them,\n    - remove broken newly written output,\n    - return `VerifyFailed`.\n\n## Logging Assertions\n\nUse `tracing-test` (or equivalent) to capture logs in tests.\n- Assert key trace messages appear: source resolved, write started, verify passed/failed, rollback actions.\n\n## Acceptance Criteria\n\n- Pipeline tests cover all branches and are deterministic.\n- Logs emitted by pipeline are asserted for key stages.\n- Verify-failure rollback invariants are asserted (no leftover \"new\" output when failing).","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T21:07:17.545739660Z","created_by":"ubuntu","updated_at":"2026-02-08T22:49:56.803715501Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["pipeline","testing"],"dependencies":[{"issue_id":"bd-24z.9","depends_on_id":"bd-24z","type":"parent-child","created_at":"2026-02-08T21:49:11.044946233Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.9","depends_on_id":"bd-2zw.6","type":"blocks","created_at":"2026-02-08T21:07:57.759639003Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.9","depends_on_id":"bd-ikb.1","type":"blocks","created_at":"2026-02-08T21:07:21.924294875Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-24z.9","depends_on_id":"bd-ikb.2","type":"blocks","created_at":"2026-02-08T21:07:22.004626263Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2rl","title":"EPIC: Canonical Session Model","description":"Define the canonical intermediate representation (IR) for coding agent sessions. This is the Rosetta Stone of casr: every provider's native format is normalized into this IR, and every target format is generated from it.\n\nPort/adapt the conversion-relevant data types and helper logic from CASS (coding_agent_session_search), but keep the IR focused on *session conversion*, not CASS's indexing/search features.\n\nThe canonical model must capture:\n- ordered messages with roles (user/assistant/tool/system)\n- timestamps (normalized to epoch millis)\n- workspace/cwd when available\n- session identity (source id and generated target id)\n- model name (session-level convenience + message-level author)\n- tool calls/results when representable\n- provider-specific passthrough fields (lossless preservation via `session.metadata` and `message.extra`)\n\nIntentional non-goals (do NOT pull in CASS-only indexing baggage):\n- snippet extraction/indexing types (casr can derive summaries from message content without storing snippets as first-class IR fields)\n- database ids / remote-origin fields\n\n## Success Criteria\n\n- `CanonicalSession`/`CanonicalMessage` are expressive enough to write plausible sessions for core providers.\n- Provider-specific fields that cannot be canonically represented are preserved in `metadata`/`extra`.\n- Timestamp and content normalization helpers are centralized and exhaustively unit-tested.\n- IR choices are documented so writer implementations have clear mapping rules.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:36:44.447987709Z","created_by":"ubuntu","updated_at":"2026-02-09T05:41:43.484209368Z","closed_at":"2026-02-09T05:41:43.484180534Z","close_reason":"All 3 children completed: CanonicalSession/CanonicalMessage types defined (bd-2rl.1), Provider trait defined (bd-2rl.2), all 5 content normalization helpers implemented (bd-2rl.3). The canonical IR is complete and ready for readers/writers to use.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","model"],"dependencies":[{"issue_id":"bd-2rl","depends_on_id":"bd-2zw","type":"blocks","created_at":"2026-02-08T20:46:04.457331048Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2rl.1","title":"Define CanonicalSession and CanonicalMessage types","description":"Port and adapt the core session data model from CASS (conversion-relevant subset). Define these types in `src/model.rs`.\n\n## Types\n\n`CanonicalSession`:\n- `session_id: String`\n- `provider_slug: String` (source provider slug: `claude-code`, `codex`, `gemini`)\n- `workspace: Option<PathBuf>` (project root / cwd)\n- `title: Option<String>`\n- `started_at: Option<i64>` (epoch millis)\n- `ended_at: Option<i64>` (epoch millis)\n- `messages: Vec<CanonicalMessage>`\n- `metadata: serde_json::Value` (provider-specific extras that don't map to canonical fields; default `{}`)\n- `source_path: Option<PathBuf>` (native file location when known)\n- `model_name: Option<String>` (session-level convenience; may be derived from per-message author/model)\n\n`CanonicalMessage`:\n- `idx: usize` (0-based sequential order)\n- `role: MessageRole`\n- `content: String` (primary human-readable text)\n- `timestamp: Option<i64>` (epoch millis)\n- `author: Option<String>` (model name or identifier)\n- `tool_calls: Vec<ToolCall>`\n- `tool_results: Vec<ToolResult>`\n- `extra: serde_json::Value` (provider-specific raw fields; default `{}`; SHOULD include raw native record/content blocks when available)\n\n`MessageRole` enum:\n- `User`\n- `Assistant`\n- `Tool`\n- `System`\n- `Other(String)`\n\nNaming note:\n- CASS uses \"Agent\" in some places; casr uses `Assistant` as the canonical variant. Normalization helpers should map `agent`/`model` -> `Assistant`.\n\nTool structs:\n- `ToolCall { id: Option<String>, name: String, arguments: serde_json::Value }`\n- `ToolResult { call_id: Option<String>, content: String, is_error: bool }`\n\nDerives:\n- All types derive `Debug`, `Clone`, `Serialize`, `Deserialize`.\n- `CanonicalSession` and `CanonicalMessage` derive `PartialEq` for testing.\n\n## Intentional Omissions vs CASS\n\nDo NOT pull in CASS indexing/search-only fields (e.g., Snippet extraction/index ids). casr only needs conversion fidelity; summaries can be derived from message content.\n\n## Acceptance Criteria\n\n- Types compile cleanly with serde derives and `#![forbid(unsafe_code)]`.\n- Defaults for `metadata`/`extra` are stable (empty object, not null) to simplify writers.\n- Canonical model supports representing tool calls/results without forcing provider-specific schemas.\n- Unit tests validate serde round-trip and equality semantics for representative sessions/messages.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:39:20.241612244Z","created_by":"ubuntu","updated_at":"2026-02-09T05:39:33.728375004Z","closed_at":"2026-02-09T05:39:33.728355216Z","close_reason":"All types defined in src/model.rs: CanonicalSession (10 fields), CanonicalMessage (8 fields), MessageRole (5 variants), ToolCall, ToolResult. All derive Debug+Clone+Serialize+Deserialize, Session/Message also PartialEq. CASS naming note (Agent→Assistant) and deliberately omitted fields documented in module doc.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","model"],"dependencies":[{"issue_id":"bd-2rl.1","depends_on_id":"bd-2rl","type":"parent-child","created_at":"2026-02-08T21:49:10.438561462Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2rl.1","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:44:24.727876844Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2rl.2","title":"Define Provider trait with read/write/detect methods","description":"Define the Provider trait in `src/providers/mod.rs`. This is the core abstraction that each provider (Claude Code, Codex, Gemini, and future providers) implements.\n\n## Trait Surface\n\n```rust\npub trait Provider {\n    /// Human-readable name (e.g. \"Claude Code\")\n    fn name(&self) -> &str;\n\n    /// Stable slug used in logs/metadata (e.g. \"claude-code\", \"codex\", \"gemini\")\n    fn slug(&self) -> &str;\n\n    /// CLI alias used in `casr <alias> resume ...` (e.g. \"cc\", \"cod\", \"gmi\")\n    fn cli_alias(&self) -> &str;\n\n    /// Detect presence of the provider binary + session roots.\n    /// This MUST be evidence-rich (not a single bool).\n    fn detect(&self) -> DetectionResult;\n\n    /// Candidate session roots for this provider (respects *_HOME overrides).\n    fn session_roots(&self) -> Vec<std::path::PathBuf>;\n\n    /// Fast ownership check: return the native session file path if this provider owns `session_id`.\n    /// Should avoid full file parsing when possible.\n    fn owns_session(&self, session_id: &str) -> Option<std::path::PathBuf>;\n\n    /// Read a session from native format into canonical IR.\n    fn read_session(&self, path: &std::path::Path) -> anyhow::Result<CanonicalSession>;\n\n    /// Write a canonical session into this provider's native format.\n    /// Returns all paths written + generated session_id.\n    fn write_session(&self, session: &CanonicalSession, opts: &WriteOptions)\n        -> anyhow::Result<WrittenSession>;\n\n    /// The resume command string for this provider (e.g. `claude --resume <id>`).\n    fn resume_command(&self, session_id: &str) -> String;\n}\n```\n\nAlso define:\n\n```rust\npub struct DetectionResult {\n    pub binary: Option<BinaryEvidence>,\n    pub roots: Vec<RootEvidence>,\n    pub notes: Vec<String>,\n}\n\npub struct BinaryEvidence {\n    pub exe: std::path::PathBuf,\n    pub version: Option<String>,\n}\n\npub struct RootEvidence {\n    pub path: std::path::PathBuf,\n    pub exists: bool,\n    pub readable: bool,\n    pub writable: bool,\n    pub evidence: Vec<String>,\n}\n\nimpl DetectionResult {\n    pub fn can_read(&self) -> bool { /* any readable root */ }\n    pub fn can_write(&self) -> bool { /* any writable root OR creatable root */ }\n    pub fn can_resume(&self) -> bool { self.binary.is_some() }\n}\n\npub struct WrittenSession {\n    pub paths: Vec<std::path::PathBuf>,\n    pub session_id: String,\n    pub resume_command: String,\n    pub backup_paths: Vec<std::path::PathBuf>,\n}\n\npub struct WriteOptions {\n    pub force: bool,\n}\n```\n\n## Detection Semantics (Critical For UX)\n\n- `detect()` MUST distinguish:\n  - binary present vs missing (`can_resume()`),\n  - session roots present/readable (`can_read()`),\n  - session roots writable/creatable (`can_write()`).\n- casr should be able to READ sessions even when the provider binary is not installed.\n- casr should be able to WRITE sessions as long as roots are writable/creatable, even if the binary is missing (warn in UX).\n\n## Conflict + Backup Policy\n\n- Conflict/`--force` handling MUST live in exactly one place: `atomic_write` (bd-ikb.3).\n- Provider writers call `atomic_write`; the pipeline should not duplicate pre-checks (avoid TOCTOU).\n- `WrittenSession.backup_paths` is surfaced to UX so users can find restored/overwritten files.\n\n## Acceptance Criteria\n\n- `Provider` is object-safe and storable as `Box<dyn Provider>` in a registry.\n- `DetectionResult` is rich enough to power `casr providers` output (binary evidence + root evidence + notes).\n- Env var overrides are supported for root derivation: `CLAUDE_HOME`, `CODEX_HOME`, `GEMINI_HOME`.\n- `write_session()` uses `WriteOptions.force` and surfaces backup paths when overwriting.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:39:32.295047628Z","created_by":"ubuntu","updated_at":"2026-02-09T05:39:53.161795562Z","closed_at":"2026-02-09T05:39:53.161775054Z","close_reason":"Provider trait already defined in src/providers/mod.rs: 9 methods (name, slug, cli_alias, detect, session_roots, owns_session, read_session, write_session, resume_command). Object-safe (Send+Sync). WriteOptions{force}, WrittenSession{paths,session_id,resume_command,backup_path}, DetectionResult in discovery.rs. Design note on conflict handling documented in trait comments.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","model"],"dependencies":[{"issue_id":"bd-2rl.2","depends_on_id":"bd-2rl","type":"parent-child","created_at":"2026-02-08T21:49:10.241171305Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2rl.2","depends_on_id":"bd-2rl.1","type":"blocks","created_at":"2026-02-08T20:44:24.800231584Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2rl.3","title":"Implement helper functions for content normalization","description":"Port/adapt the shared normalization utilities from CASS connector helpers. These are used by all readers and writers and must be centralized.\n\n## Helpers\n\n1. `flatten_content(value: &serde_json::Value) -> String`\n\nHandles content representations across providers:\n- string -> string\n- array of blocks -> concatenate extracted parts\n  - `{type:\"text\", text:\"...\"}` and `{type:\"input_text\", text:\"...\"}` contribute text\n  - `{type:\"tool_use\", name:\"...\", input:{...}}` contributes a stable human-readable marker like `[Tool: name - <description>]`\n  - mixed arrays (text + tool_use + strings) must be supported\n- object with `text` field -> text\n- null/number/bool/unexpected -> empty\n\n2. `parse_timestamp(value: &serde_json::Value) -> Option<i64>`\n\nParse timestamps into epoch millis:\n- i64 seconds vs millis heuristic (critical for correctness)\n- numeric strings and float strings\n- ISO-8601/RFC3339 with offsets, with/without fractional seconds\n- NEVER panics; returns None on unparseable input\n\n3. `reindex_messages(messages: &mut Vec<CanonicalMessage>)`\n\nAfter filtering/sorting, reassign `idx` to 0..N-1.\n\n4. `truncate_title(text: &str, max_len: usize) -> String`\n\nTitle extraction: first line, trimmed, truncated with `...`.\n\n5. `normalize_role(role_str: &str) -> MessageRole`\n\nCase-insensitive mapping:\n- user -> User\n- assistant/model/agent -> Assistant\n- tool -> Tool\n- system -> System\n- other -> Other(role)\n\n## Tool Call/Result Extraction (Best-Effort)\n\nIn addition to `flatten_content`, add best-effort helpers to extract structured tool data when present in native schemas:\n- `extract_tool_calls(val) -> Vec<ToolCall>` from content blocks like `{type:\"tool_use\", name, input}`\n- `extract_tool_results(val) -> Vec<ToolResult>` where providers encode results in-message\n\nWhen extraction is not possible, preserve raw provider fields in `message.extra`.\n\n## Acceptance Criteria\n\n- Helpers match CASS behavior for timestamp parsing + content flattening (parity tests in bd-24z.10).\n- Helper tests cover edge cases exhaustively (bd-24z.7) and include detailed failure logs.\n- No helper ever panics on malformed provider data.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T20:39:43.396341180Z","created_by":"ubuntu","updated_at":"2026-02-09T05:41:36.673699833Z","closed_at":"2026-02-09T05:41:36.673645642Z","close_reason":"Implemented all 5 helpers in src/model.rs: flatten_content (handles string, text/input_text/tool_use arrays, mixed arrays, objects with text field), parse_timestamp (seconds/millis heuristic at 100B threshold, float, ISO-8601, RFC 3339), reindex_messages, truncate_title (first line with char-boundary-safe truncation), normalize_role (case-insensitive, agent→Assistant). Clippy clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","model"],"dependencies":[{"issue_id":"bd-2rl.3","depends_on_id":"bd-2rl","type":"parent-child","created_at":"2026-02-08T21:49:13.880037435Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2rl.3","depends_on_id":"bd-2rl.1","type":"blocks","created_at":"2026-02-08T20:44:24.868053890Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw","title":"EPIC: Project Bootstrap & Scaffold","description":"Set up the casr (Cross Agent Session Resumer) Rust project from scratch. This is a CLI tool that allows users to resume AI coding agent sessions from one provider using a different provider. E.g., `casr cc resume <codex-session-id>` would let Claude Code resume a session originally created by Codex. The tool auto-detects the originating provider, converts through a canonical intermediate format, and writes a valid session file in the target provider's native format. Binary name: `casr`.\n\nCovers: Cargo.toml, directory structure, AGENTS.md, rust-toolchain.toml, .gitignore, CI scaffolding, and the initial module skeleton.\n\n## Success Criteria\n\n- Repo builds cleanly under Rust nightly (edition 2024): `cargo check --all-targets`.\n- Base CI workflow exists and runs at least fmt/clippy/test (can be expanded later).\n- Module skeleton exists with clear boundaries (model/providers/discovery/pipeline/errors).\n- Guardrails for CASS vendoring and no-runtime-dependency are documented and testable.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:36:35.788994132Z","created_by":"ubuntu","updated_at":"2026-02-09T05:38:44.811940858Z","closed_at":"2026-02-09T05:38:44.811918256Z","close_reason":"All 7 children completed: Cargo project initialized (bd-2zw.1), module skeleton created (bd-2zw.2), AGENTS.md adapted (bd-2zw.3), CI workflow created (bd-2zw.4), error types implemented (bd-2zw.5), tracing infrastructure set up (bd-2zw.6), CASS independence policy codified (bd-2zw.7). cargo check/clippy/fmt all pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bootstrap","infrastructure"]}
{"id":"bd-2zw.1","title":"Initialize Cargo project with proper structure","description":"Run `cargo init` or manually create `Cargo.toml` for the casr project.\n\nKey settings:\n- name=`casr`\n- edition=`2024`\n- rust-toolchain nightly\n- dependencies: `clap` (derive), `serde`/`serde_json`, `anyhow`, `thiserror`, `chrono`, `colored`, `walkdir`, `glob`, `dirs`, `uuid`, `which`\n- release profile: `opt-level='z'`, `lto=true`, `codegen-units=1`, `panic='abort'`, `strip=true`\n\nCreate:\n- `rust-toolchain.toml`\n- `.gitignore` (`/target`, editor temp files, OS noise)\n- `build.rs` with `vergen-gix` for build metadata\n\nVersion output requirement:\n- `casr --version` includes version + git commit + build date + target triple.\n\nCASS Independence Policy (MANDATORY):\n1. casr MUST NOT add `coding_agent_session_search` (CASS) as a runtime dependency (no git/path/crates linkage).\n2. We may copy/adapt relevant connector logic into casr source code (vendoring), but all code must build and run with casr alone.\n3. Preserve attribution and MIT license compliance for copied/adapted snippets.\n4. Add a short `docs/cass-porting-notes.md` documenting:\n   - source files copied/adapted,\n   - behavior deltas introduced in casr,\n   - the rationale for no-runtime-dependency architecture.\n\nNOTE: Additional crates are added by later tasks — tracing/tracing-subscriber (bd-2zw.6), tempfile (tests), assert_cmd/predicates (e2e tests), clap_complete (shell completions).\n\n## Acceptance Criteria\n\n- `cargo check --all-targets` succeeds after scaffold (even with TODO stubs).\n- Crate roots include `#![forbid(unsafe_code)]`.\n- Release profile matches the size-optimized settings above.\n- `casr --version` prints vergen-gix build metadata.\n- `.gitignore` prevents committing build artifacts and local caches.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:38:41.026548622Z","created_by":"ubuntu","updated_at":"2026-02-09T05:29:43.037587247Z","closed_at":"2026-02-09T05:29:43.037564775Z","close_reason":"All acceptance criteria met: cargo check passes, #![forbid(unsafe_code)] in both crate roots, release profile size-optimized, casr --version shows git SHA + build timestamp + target triple, .gitignore covers /target and editor noise. Files created: Cargo.toml, rust-toolchain.toml, build.rs, src/main.rs, src/lib.rs, docs/cass-porting-notes.md","source_repo":".","compaction_level":0,"original_size":0,"labels":["bootstrap"],"dependencies":[{"issue_id":"bd-2zw.1","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T22:58:17.031194185Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw.2","title":"Create module skeleton with proper file layout","description":"Create the initial Rust module structure.\n\nFiles to create:\n- `src/main.rs` (entry point, clap CLI dispatch)\n- `src/lib.rs` (public API)\n- `src/model.rs` (canonical session types)\n- `src/providers/mod.rs` (provider trait + wiring)\n- `src/providers/claude_code.rs` (reader+writer stub)\n- `src/providers/codex.rs` (reader+writer stub)\n- `src/providers/gemini.rs` (reader+writer stub)\n- `src/discovery.rs` (provider detection + session lookup)\n- `src/pipeline.rs` (conversion orchestration)\n- `src/error.rs` (typed errors)\n\nEach file starts with a module doc comment explaining its purpose and a minimal skeleton (pub struct/trait/fn with `todo!()` where appropriate). The module tree should compile with `cargo check` even if everything is unimplemented.\n\n## Acceptance Criteria\n\n- `cargo check --all-targets` passes with the skeleton in place.\n- Public module boundaries match the \"Key Files\" list in `AGENTS.md`.\n- Each module has a short top-level doc comment describing its responsibility.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:38:47.953059288Z","created_by":"ubuntu","updated_at":"2026-02-09T05:32:19.743575915Z","closed_at":"2026-02-09T05:32:19.743557040Z","close_reason":"All 10 source files created matching AGENTS.md Key Files table. cargo check, clippy (-D warnings), and fmt all pass. Each module has doc comments, Provider trait is object-safe, all stubs reference their implementing bead ID.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bootstrap"],"dependencies":[{"issue_id":"bd-2zw.2","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T21:49:10.640829009Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2zw.2","depends_on_id":"bd-2zw.1","type":"blocks","created_at":"2026-02-08T20:44:20.398877633Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw.3","title":"Write AGENTS.md adapted for casr project","description":"Adapt the dcg AGENTS.md for the casr project. Keep the universal rules (Rule 0 override, Rule 1 no file deletion, no destructive git commands, Rust/Cargo toolchain, code editing discipline, no file proliferation, no backwards compatibility concerns, compiler checks, br/bv workflow, session completion protocol, multi-agent coexistence). Replace all dcg-specific content with casr-specific content: architecture overview (detect->read->canonical->write pipeline), key files table, provider system description, testing strategy, CLI reference. Remove dcg hook protocol, pattern system, allowlist, and other dcg-specific sections. Add casr-specific sections: canonical session format reference, provider format specs, round-trip testing invariants, adding new providers guide.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T20:39:01.719667755Z","created_by":"ubuntu","updated_at":"2026-02-09T05:35:33.029651757Z","closed_at":"2026-02-09T05:35:33.029633653Z","close_reason":"AGENTS.md already fully adapted for casr in prior sessions. Contains: Rule 0/1, destructive git guards, Rust/Cargo toolchain, architecture overview, key files table, provider system, CLI surface, testing strategy, canonical format reference, provider specs, round-trip invariants, adding new providers guide. No dcg content remains.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bootstrap","docs"],"dependencies":[{"issue_id":"bd-2zw.3","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T21:49:14.294193372Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2zw.3","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:44:20.472850211Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw.4","title":"Set up GitHub Actions CI workflow","description":"Create `.github/workflows/ci.yml` with staged but comprehensive jobs.\n\nRequired jobs:\n1. `check`\n   - `cargo fmt --check`\n   - `cargo clippy --all-targets -- -D warnings`\n   - `cargo test`\n2. `coverage`\n   - `cargo llvm-cov`\n   - enforce thresholds for overall + critical modules (model, pipeline)\n3. `parity`\n   - run CASS parity regression suite for readers\n4. `conformance`\n   - run writer golden-output conformance suite\n5. `roundtrip`\n   - run cross-provider fidelity matrix tests\n6. `contracts`\n   - run JSON schema/contract tests for `--json` outputs\n7. `e2e`\n   - run `scripts/e2e_test.sh` with isolated provider homes\n8. `smoke-real` (opt-in)\n   - run real-provider acceptance harness when provider binaries/homes are available\n9. `perf-regression`\n   - run targeted discovery/reader/writer perf regression checks and enforce documented budgets\n\nWorkflow requirements:\n- Use `actions/checkout`, nightly toolchain, and Rust cache.\n- Emit artifacts on failure (logs, generated outputs, diffs, coverage reports, schema diffs, perf metrics).\n- Provide clear job summaries with first failing assertion location.\n- Keep a secrets-free path for local reproducibility.\n- Explicitly mark required vs optional jobs (no silent skipping).\n\nImplementation strategy:\n- Start with `check` + `coverage`, then incrementally enable parity/conformance/roundtrip/e2e/perf as tasks land.\n- Preserve deterministic output paths so failed artifacts are easy to compare across runs.\n\n## Acceptance Criteria\n\n- CI includes parity, conformance, roundtrip, contracts, e2e, and perf jobs with artifact upload.\n- Failure output is actionable without re-running immediately.\n- Optional real-provider smoke job is explicit and non-silent when skipped.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T20:39:07.872512054Z","created_by":"ubuntu","updated_at":"2026-02-09T05:38:27.669645567Z","closed_at":"2026-02-09T05:38:27.669624929Z","close_reason":"Created .github/workflows/ci.yml with check job (fmt, clippy, test, CASS independence guardrail) and build job (release build). Uses dtolnay/rust-toolchain nightly and Swatinem/rust-cache.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bootstrap","ci"],"dependencies":[{"issue_id":"bd-2zw.4","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T21:49:14.087396285Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2zw.4","depends_on_id":"bd-2zw.1","type":"blocks","created_at":"2026-02-08T20:44:20.544706508Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw.5","title":"Implement error types with actionable messages","description":"Define the error type hierarchy in `src/error.rs` using `thiserror`. Errors must be actionable: every error should tell the user what to do next.\n\n## Error Types\n\n- `SessionNotFound { session_id, providers_checked, roots_scanned, file_counts }`\n  - Example: `Session abc123 not found. Checked: Claude Code (roots: 2, files: 23), Codex (roots: 1, files: 156). Run 'casr list' to see sessions.`\n\n- `AmbiguousSessionId { session_id, candidates: Vec<Candidate> }`\n  - Returned when multiple providers match a user-supplied ID.\n  - Must include provider slug + resolved path per candidate.\n  - Must include remediation: `--source <alias>` or `--source <path>`.\n\n- `UnknownProviderAlias { alias, known_aliases }`\n  - Example: `Unknown provider alias xyz. Known: cc (Claude Code), cod (Codex), gmi (Gemini).`\n\n- `ProviderUnavailable { provider, reason, evidence }`\n  - Use when the requested provider cannot be used for the operation.\n  - Reasons should distinguish:\n    - binary missing (cannot resume, but may still read/write),\n    - no readable roots (cannot read),\n    - no writable/creatable roots (cannot write),\n    - permission denied / read-only root.\n\n- `SessionReadError { path, provider, detail }`\n  - Example: `Failed to read Codex session at ...: invalid JSON on line 42`.\n\n- `SessionWriteError { path, provider, detail }`\n  - Example: `Failed to write Claude Code session to ...: permission denied`.\n\n- `SessionConflict { session_id, existing_path }`\n  - Example: `Session already exists in Claude Code at ... Use --force to overwrite (creates .bak).`\n\n- `ValidationError { errors, warnings, info }`\n  - Error variant used when conversion must stop; warnings/info are still surfaced in UX/JSON.\n\n- `VerifyFailed { provider, written_paths, detail }`\n  - Used when read-back verification fails. This is a casr bug (writers/pipeline).\n\n## Library vs CLI\n\n- Use `anyhow` for internal propagation.\n- Use `thiserror` for the public error surface and for stable `--json` `error_type` strings.\n- The CLI layer renders errors with colors and remediation hints; `--json` outputs the structured envelope.\n\n## Acceptance Criteria\n\n- Error types cover: not found, ambiguous, unreadable, unwritable, conflict, read/write/verify failures.\n- `AmbiguousSessionId` is implemented and propagated from discovery/pipeline.\n- `ProviderUnavailable` can represent \"binary missing but roots writable\" as a WARNING in UX (not a hard error unless write is impossible).\n- Error rendering is stable and covered by JSON contract tests (bd-24z.11).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T20:45:23.335783079Z","created_by":"ubuntu","updated_at":"2026-02-09T05:35:15.720314392Z","closed_at":"2026-02-09T05:35:15.720295086Z","close_reason":"All error types implemented in src/error.rs: SessionNotFound, AmbiguousSessionId, UnknownProviderAlias, ProviderUnavailable, SessionReadError, SessionWriteError, SessionConflict, ValidationError (with warnings/info), VerifyFailed. All compile clean with clippy -D warnings.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","errors"],"dependencies":[{"issue_id":"bd-2zw.5","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T21:49:12.256540775Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2zw.5","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:45:27.355019002Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw.6","title":"Set up tracing/logging infrastructure for tests and debugging","description":"Add structured tracing to casr using `tracing` and `tracing-subscriber`. This provides detailed, filterable logging critical for debugging conversion failures.\n\n## Setup\n\n1. Add dependencies:\n   - `tracing`\n   - `tracing-subscriber` (features: `env-filter`, `fmt`)\n2. Initialize subscriber in `main.rs` with an `EnvFilter` that can be overridden by CLI flags.\n3. Add `trace!()`/`debug!()` calls at key stages (with spans + timings):\n   - Provider detection: each provider checked, evidence gathered\n   - Session discovery: roots scanned, fast-path hits, ambiguity decisions\n   - Readers: line/event parsed, role mapping, timestamp parsing path, workspace inference path\n   - Writers: output path chosen, ID generated, backup/overwrite actions\n   - Pipeline: stage boundaries (resolve, read, validate, write, verify) + elapsed ms\n\n## User Controls\n\n- Environment: `RUST_LOG=casr=debug|trace ...`\n- CLI flags: `--verbose` (debug) and `--trace` (trace) should configure the filter directly and predictably.\n\n## Testing Hooks\n\n- Add `tracing-test` (or equivalent) for unit tests that assert logs are emitted in critical branches (bd-24z.9).\n\n## Acceptance Criteria\n\n- All core pipeline stages emit structured spans and stage timings.\n- `--verbose`/`--trace` reliably increase verbosity without requiring users to set `RUST_LOG`.\n- Unit tests can capture logs and assert key messages/spans exist.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T21:04:30.547846148Z","created_by":"ubuntu","updated_at":"2026-02-09T05:37:35.303771324Z","closed_at":"2026-02-09T05:37:35.303751326Z","close_reason":"Added tracing + tracing-subscriber (env-filter, fmt) to Cargo.toml. Implemented init_tracing() in main.rs: --trace sets casr=trace, --verbose sets casr=debug, falls back to RUST_LOG env var, defaults to warn. Output goes to stderr with target module names.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bootstrap","logging","testing"],"dependencies":[{"issue_id":"bd-2zw.6","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T21:49:12.051212247Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2zw.6","depends_on_id":"bd-2zw.1","type":"blocks","created_at":"2026-02-08T21:04:37.364268576Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zw.7","title":"Codify CASS vendoring policy and no-runtime-dependency guardrails","description":"Create explicit architecture guardrails for porting CASS behavior into casr without runtime coupling.\n\nDeliverables:\n1. `docs/cass-porting-notes.md` with:\n   - Source mapping for initial provider ports (CASS -> casr):\n     - CASS `src/connectors/claude_code.rs` -> casr `src/providers/claude_code.rs`\n     - CASS `src/connectors/codex.rs` -> casr `src/providers/codex.rs`\n     - CASS `src/connectors/gemini.rs` -> casr `src/providers/gemini.rs`\n     - CASS shared helpers in `src/connectors/mod.rs` -> casr shared helpers in `src/model.rs` (timestamp parsing, content flattening, message reindexing, role normalization)\n   - Behavior-preservation notes and intentional casr deltas.\n   - Test references proving parity/conformance.\n2. `docs/cass-independence-policy.md` with hard rules:\n   - No Cargo dependency/path/git linkage to `coding_agent_session_search`.\n   - Vendored/adapted code must live and compile solely within casr.\n   - Any future provider adaptation follows the same policy.\n3. MIT attribution/compliance note for adapted code snippets.\n4. CI guardrail that fails if `Cargo.toml`/`Cargo.lock` references CASS as a dependency.\n\n## Acceptance Criteria\n\n- Policy docs are committed and referenced from README and AGENTS.md.\n- CI guardrail exists and is exercised by tests.\n- Porting notes include at least one concrete mapping example per core provider.\n- No runtime dependency edge exists from casr to CASS.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T21:59:47.919324458Z","created_by":"ubuntu","updated_at":"2026-02-09T05:38:27.764181163Z","closed_at":"2026-02-09T05:38:27.764162518Z","close_reason":"Created docs/cass-independence-policy.md with hard rules. docs/cass-porting-notes.md already has source mapping table. CI guardrail in ci.yml greps for coding_agent_session_search in Cargo.toml/Cargo.lock. Verified locally: PASS.","source_repo":".","compaction_level":0,"original_size":0,"labels":["architecture","bootstrap","docs"],"dependencies":[{"issue_id":"bd-2zw.7","depends_on_id":"bd-2zw","type":"parent-child","created_at":"2026-02-08T21:59:47.919324458Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2zw.7","depends_on_id":"bd-2zw.1","type":"blocks","created_at":"2026-02-08T21:59:47.919324458Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3my","title":"EPIC: Provider Detection & Session Discovery","description":"Implement the system that auto-detects which AI coding agent providers are available on the machine and can locate sessions by ID across all of them.\n\nWhen a user runs `casr cc resume <session-id>`, casr must:\n1. Determine which provider owns `<session-id>` (or surface ambiguity deterministically).\n2. Resolve the native session file path.\n3. Produce actionable diagnostics when not found.\n\nThis epic covers:\n- provider registry\n- filesystem probing (session roots)\n- evidence-rich detection (binary vs roots vs read/write capability)\n- cross-provider session ID lookup and ambiguity handling\n\nLeverage CASS probe patterns where useful, but keep casr independent (vendored logic only; no runtime dependency).\n\n## Success Criteria\n\n- `casr providers` can explain for each provider: binary presence, roots, and read/write capability.\n- Source discovery works even when provider binaries are missing (roots present).\n- Ambiguous session IDs are surfaced as explicit errors with remediation (`--source`).\n- Performance stays interactive: fast-path ownership checks avoid full parsing in common cases.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:37:46.605306684Z","created_by":"ubuntu","updated_at":"2026-02-09T05:50:05.715368280Z","closed_at":"2026-02-09T05:50:05.715343493Z","close_reason":"All children complete: bd-3my.1 (registry+detection), bd-3my.2 (cross-provider session lookup with ambiguity handling).","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","discovery"],"dependencies":[{"issue_id":"bd-3my","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-08T20:46:04.536455699Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3my.1","title":"Implement provider registry with auto-detection","description":"Create the `ProviderRegistry` in `src/discovery.rs`. This is the central registry that knows about all supported providers and their detection/roots.\n\n## Core Types\n\n```rust\npub struct ProviderRegistry {\n    providers: Vec<Box<dyn Provider>>,\n}\n\nimpl ProviderRegistry {\n    pub fn new() -> Self;\n\n    /// Evidence-rich detection for `casr providers`.\n    pub fn detect_all(&self) -> Vec<ProviderStatus>;\n\n    pub fn find_by_slug(&self, slug: &str) -> Option<&dyn Provider>;\n    pub fn find_by_alias(&self, alias: &str) -> Option<&dyn Provider>;\n\n    /// Providers that have readable roots (binary not required).\n    pub fn providers_for_read(&self) -> Vec<&dyn Provider>;\n\n    /// Providers that have writable/creatable roots (binary not required).\n    pub fn providers_for_write(&self) -> Vec<&dyn Provider>;\n}\n\npub struct ProviderStatus {\n    pub slug: String,\n    pub name: String,\n    pub alias: String,\n    pub detection: DetectionResult,\n}\n```\n\n## Detection Checks (Per Provider)\n\nEach provider's `detect()` should collect evidence for both binary + session roots:\n\n- Claude Code:\n  - binary: `claude` in `PATH`\n  - roots: `~/.claude/` (or `CLAUDE_HOME`) and `~/.claude/projects/`\n- Codex:\n  - binary: `codex` in `PATH`\n  - roots: `~/.codex/` (or `CODEX_HOME`) and `~/.codex/sessions/`\n- Gemini CLI:\n  - binary: `gemini` in `PATH`\n  - roots: `~/.gemini/` (or `GEMINI_HOME`) and `~/.gemini/tmp/*/chats/`\n\nUse:\n- `which` crate for binary detection.\n- `dirs` crate for home directory resolution.\n- Env var overrides (`CLAUDE_HOME`, `CODEX_HOME`, `GEMINI_HOME`) must take precedence and must be surfaced in detection evidence.\n\n## UX-Driven Semantics\n\n- Do NOT reduce detection to a single `installed: bool`.\n- Source discovery must consider providers with readable roots even if binary is missing.\n- Target conversion must allow writing when roots are writable/creatable even if binary is missing (UX prints an installation hint as a warning).\n\n## Acceptance Criteria\n\n- Registry wiring includes Claude Code, Codex, and Gemini providers.\n- `detect_all()` returns evidence-rich status suitable for `casr providers` (binary path/version, roots, read/write capability).\n- `providers_for_read()` and `providers_for_write()` reflect `DetectionResult.can_read()` / `can_write()`.\n- Unit tests cover env var overrides and detection evidence rendering (bd-24z.8).","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:39:52.620082750Z","created_by":"ubuntu","updated_at":"2026-02-09T05:45:54.613809854Z","closed_at":"2026-02-09T05:45:54.613791129Z","close_reason":"Implemented ProviderRegistry (detect_all, installed_providers, all_providers, find_by_slug, find_by_alias, find_session, known_aliases, default_registry) + all 3 provider detect/session_roots/owns_session methods with env var overrides. Clippy clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","discovery"],"dependencies":[{"issue_id":"bd-3my.1","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T20:44:29.075935730Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3my.1","depends_on_id":"bd-3my","type":"parent-child","created_at":"2026-02-08T21:49:10.039892047Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3my.2","title":"Implement cross-provider session ID lookup","description":"Implement the cross-provider session ownership resolver that powers source auto-detection for casr <target> resume <session-id>.\n\nGoal: given a user-supplied session identifier, determine the source provider and canonical source file path with deterministic, debuggable behavior.\n\nResolution algorithm (in order):\n1. If --source <alias> is provided, only search that provider.\n2. If --source <path> is provided, bypass discovery and resolve directly to that file.\n3. Fast-path lookup by provider-specific filename/path conventions (no full file parse):\n   - Claude Code: <id>.jsonl under ~/.claude/projects/*/\n   - Codex: relative rollout-path IDs under ~/.codex/sessions/**/rollout-*.jsonl|json\n   - Gemini: session-*.json in ~/.gemini/tmp/*/chats/\n4. Fallback content-based lookup only when needed:\n   - Claude: check first matching JSONL events for sessionId\n   - Codex: check metadata/payload-derived IDs if path match is insufficient\n   - Gemini: check top-level sessionId\n5. If exactly one provider matches: return (provider, path).\n6. If multiple providers match: return an explicit AmbiguousSessionId error with candidate providers/paths and remediation (--source).\n7. If none match: return SessionNotFound with detailed diagnostics (providers checked, roots scanned, file-count summary).\n\nPerformance requirements:\n- Avoid full recursive content parsing on the hot path.\n- Short-circuit on unique match when ambiguity is impossible.\n- Cache lookup results in-process for repeated calls in one invocation.\n- Emit trace/debug logs for decision path and timing.\n\nDesign constraints:\n- Deterministic results across runs.\n- Works with env-var home overrides (CLAUDE_HOME, CODEX_HOME, GEMINI_HOME).\n- No dependency on CASS at runtime (logic is vendored/adapted only).\n\nAcceptance criteria:\n- Supports alias-hinted, path-hinted, and fully automatic source resolution.\n- Returns deterministic AmbiguousSessionId errors when multiple providers match.\n- Provides actionable SessionNotFound diagnostics with provider/root/file-count context.\n- Fast-path lookup avoids unnecessary full-file parsing for common cases.\n- Includes unit coverage for unique match, ambiguous match, no match, and hint override behavior.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-08T20:40:10.318663035Z","created_by":"ubuntu","updated_at":"2026-02-09T05:50:00.789803362Z","closed_at":"2026-02-09T05:50:00.789782914Z","close_reason":"Implemented resolve_session() with full 3-path algorithm: SourceHint::Path bypass, SourceHint::Alias constrained search, and auto-discovery with ambiguity detection. Returns AmbiguousSessionId/SessionNotFound with actionable diagnostics. Clippy+fmt clean.","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","discovery"],"dependencies":[{"issue_id":"bd-3my.2","depends_on_id":"bd-3my","type":"parent-child","created_at":"2026-02-08T21:49:09.831769628Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3my.2","depends_on_id":"bd-3my.1","type":"blocks","created_at":"2026-02-08T20:44:29.148969190Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb","title":"EPIC: Conversion Pipeline & Orchestration","description":"Wire up the complete conversion pipeline:\n\n`detect/resolve source` → `read native` → `canonical IR` → `validate` → `write target native` → `verify read-back` → `print resume command`.\n\nThis is the orchestration layer that ties readers, writers, and discovery together. Must handle:\n- validation (is the source session complete enough to convert?)\n- conflict detection + `--force` backup semantics\n- atomic writes (temp-then-rename)\n- rollback on failure (including verify failures)\n- progress reporting and rich logs\n- dry-run mode (no filesystem writes)\n\n## Success Criteria\n\n- One command converts and prints the exact target resume command.\n- No conversion leaves partial artifacts behind; `--force` is always recoverable via backups.\n- Writers are verified via read-back before reporting success.\n- Errors are actionable and debuggable from logs/artifacts.","status":"open","priority":0,"issue_type":"epic","created_at":"2026-02-08T20:38:16.762956837Z","created_by":"ubuntu","updated_at":"2026-02-08T22:52:13.683179027Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","pipeline"],"dependencies":[{"issue_id":"bd-ikb","depends_on_id":"bd-1a2","type":"blocks","created_at":"2026-02-08T20:46:04.900040558Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb","depends_on_id":"bd-20x","type":"blocks","created_at":"2026-02-08T20:46:04.800373647Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb","depends_on_id":"bd-3my","type":"blocks","created_at":"2026-02-08T20:46:04.978876910Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb.1","title":"Implement conversion pipeline orchestrator","description":"Implement the core conversion pipeline in `src/pipeline.rs`. This is the GENERIC orchestrator that works through the `Provider` trait; it must not depend on concrete provider implementations. Concrete providers are wired in by the integration task (bd-ikb.5).\n\n## Core API\n\n```rust\npub struct ConversionPipeline {\n    registry: ProviderRegistry,\n}\n\npub struct ConvertOptions {\n    pub dry_run: bool,\n    pub force: bool,\n    pub source_hint: Option<String>, // alias or path, see bd-3my.2\n}\n\npub struct ConversionResult {\n    pub source_provider: String,\n    pub target_provider: String,\n    pub canonical_session: CanonicalSession,\n    pub written: Option<WrittenSession>,\n    pub warnings: Vec<String>,\n}\n\nimpl ConversionPipeline {\n    pub fn convert(\n        &self,\n        target_alias: &str,\n        session_id: &str,\n        opts: ConvertOptions,\n    ) -> anyhow::Result<ConversionResult>;\n}\n```\n\n## Pipeline Steps\n\n1. Resolve the target provider from CLI alias (`cc`/`cod`/`gmi`) via the registry.\n2. Validate target provider is writable/creatable (`DetectionResult.can_write()`).\n   - If binary is missing but roots are writable, proceed and add a WARNING (user can install later).\n3. Resolve the source provider + native path via bd-3my.2 (supports `--source <alias>` and `--source <path>`).\n   - Must surface `AmbiguousSessionId` deterministically when multiple providers match.\n4. Read source session into canonical IR via `source_provider.read_session(path)`.\n5. Validate canonical session (bd-ikb.2). Stop only on validation errors; return warnings/info.\n6. If `dry_run`, stop here (no writes) and return `written=None`.\n7. Write via `target_provider.write_session(&canonical, WriteOptions { force })`.\n   - Writers MUST use `atomic_write` (bd-ikb.3) for conflict/backup semantics.\n   - The pipeline must not pre-check conflicts (avoid TOCTOU); it should map `SessionConflict` errors to UX/JSON.\n8. VERIFY: Read back the written artifact(s) via `target_provider.read_session(written_path)` and ensure parse + core invariants hold.\n   - Emit trace logs comparing message count/order/roles and timestamp deltas.\n9. On verification failure:\n   - restore any backups created during the write (never leave user worse off),\n   - remove newly written broken artifacts,\n   - return `VerifyFailed`.\n\n## Observability Requirements\n\n- Wrap major stages in tracing spans: detect/resolve, read, validate, write, verify.\n- Emit timings per stage.\n- Include source/target slugs, source session id, and all written paths in logs.\n\n## Acceptance Criteria\n\n- Pipeline is provider-generic and fully unit-testable with mock providers (bd-24z.9).\n- Pipeline uses bd-3my.2 for source resolution and propagates `AmbiguousSessionId`.\n- Target writability is enforced; missing binary is a WARNING when write is possible (not a hard error).\n- Conflict handling is centralized in `atomic_write`/writers; pipeline does not duplicate pre-checks.\n- Verification failures perform rollback/restore of backups and return a distinct `VerifyFailed` error.","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-08T20:42:26.461009045Z","created_by":"ubuntu","updated_at":"2026-02-08T22:49:05.192018833Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","pipeline"],"dependencies":[{"issue_id":"bd-ikb.1","depends_on_id":"bd-2rl.2","type":"blocks","created_at":"2026-02-08T21:03:46.088665379Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.1","depends_on_id":"bd-3my.2","type":"blocks","created_at":"2026-02-08T20:44:55.934912155Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.1","depends_on_id":"bd-ikb","type":"parent-child","created_at":"2026-02-08T21:49:08.220650550Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.1","depends_on_id":"bd-ikb.2","type":"blocks","created_at":"2026-02-08T21:03:46.000179002Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb.2","title":"Implement session validation and completeness checks","description":"Implement validation logic in the conversion pipeline that checks whether a canonical session is complete enough to be meaningfully converted. Runs between the read and write steps.\n\nValidation checks (in order):\n\nERRORS (pipeline stops):\n1. Session must have at least 1 message (empty sessions are useless).\n2. Session must have at least 1 user message AND 1 assistant message.\n\nWARNINGS (pipeline continues; surfaced in UX and `--json`):\n3. Session has no workspace (target agent may not know what project to work in).\n4. Session has no timestamps (ordering may be unreliable).\n5. Messages have unusual role ordering (e.g., two user messages in a row) — valid but may confuse the target.\n6. Very short session (<3 messages) may not provide enough context.\n7. High malformed/skipped rate in source parse (indicates possible corruption).\n\nINFO (shown only in verbose/trace and stored in `ConversionResult.warnings/info`):\n8. Session has tool calls/results (may not translate perfectly between providers).\n9. Provider-specific metadata likely to be lost in conversion.\n10. Tool call/result pairing issues (unmatched call ids).\n\nReturn `ValidationResult { errors, warnings, info }`.\n\nDesign principle: permissive rather than strict. A session that's good enough should convert, even if some metadata is lost.\n\n## Acceptance Criteria\n\n- Validation checks are fully unit-tested (bd-24z.9) and warnings/info are surfaced deterministically.\n- Validation never blocks conversion for non-critical issues; it warns instead.\n- Validation output is included in `--json` conversion results.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:42:38.039191491Z","created_by":"ubuntu","updated_at":"2026-02-08T22:53:51.467169603Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","pipeline"],"dependencies":[{"issue_id":"bd-ikb.2","depends_on_id":"bd-2rl.1","type":"blocks","created_at":"2026-02-08T20:45:00.938320509Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.2","depends_on_id":"bd-ikb","type":"parent-child","created_at":"2026-02-08T21:49:13.470558755Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb.3","title":"Implement atomic file writing with temp-then-rename","description":"Implement safe file writing for the conversion pipeline. When writing a converted session to the target provider's directory, casr must never leave partial/corrupt files or silently destroy an existing session.\n\n## Atomic Write Strategy\n\nImplement a utility used by all writers:\n\n```rust\npub struct AtomicWriteOutcome {\n    pub target_path: std::path::PathBuf,\n    pub temp_path: std::path::PathBuf,\n    pub backup_path: Option<std::path::PathBuf>,\n}\n\npub fn atomic_write(\n    target_path: &std::path::Path,\n    bytes: &[u8],\n    force: bool,\n) -> Result<AtomicWriteOutcome, CasrError>;\n\npub fn restore_backup(\n    outcome: &AtomicWriteOutcome,\n) -> Result<(), CasrError>; // best-effort restore when verify fails\n```\n\nSteps:\n1. Create parent directories (`create_dir_all`).\n2. Create temp file in same directory (e.g., `.casr-tmp-<random>`).\n3. Write bytes, flush, and `sync_all()`.\n4. Conflict handling:\n   - If target exists and `!force`: return `SessionConflict` (include existing path).\n   - If target exists and `force`: create a backup first (append `.bak`, with deterministic de-dupe like `.bak.1`, `.bak.2` if needed).\n     - Prefer atomic rename for backup when possible.\n5. Atomically rename temp -> target (`std::fs::rename` on same filesystem).\n\nCleanup/rollback rules:\n- If any step fails before temp->target rename: delete temp file.\n- If backup was created but the final rename fails: restore the backup into place.\n- On post-write verification failure (bd-ikb.1): restore backup (if any) and remove the newly written broken target.\n\nEdge cases to handle and test:\n- read-only directory, permission denied, disk full, path too long.\n- symlink targets (do not accidentally overwrite through unexpected symlink chains).\n- Windows rename semantics (best-effort; if atomic rename isn't available, still guarantee \"no partial writes\").\n\n## Acceptance Criteria\n\n- `atomic_write` guarantees \"either old target remains OR new target is fully written\".\n- `--force` always produces a recoverable backup path (reported to UX via `WrittenSession.backup_paths`).\n- Failure injection suite (bd-24z.12) can deterministically simulate failure at each stage and assert cleanup.\n- Verification failure path restores backups and removes broken outputs.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T20:42:47.332924577Z","created_by":"ubuntu","updated_at":"2026-02-08T22:49:24.076384188Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","pipeline"],"dependencies":[{"issue_id":"bd-ikb.3","depends_on_id":"bd-2zw.2","type":"blocks","created_at":"2026-02-08T20:45:01.014390863Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.3","depends_on_id":"bd-ikb","type":"parent-child","created_at":"2026-02-08T21:49:13.267306103Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb.4","title":"Implement session context enrichment for better resumption","description":"When converting a session from provider A to provider B, the target agent may benefit from additional context explaining that a conversion happened. This feature adds optional enrichment to the conversion pipeline.\n\nEnrichment options (opt-in via `--enrich`):\n1. Prepend a system message: `This session was originally created in [Provider A] and converted to [Provider B] format by casr. The original session ID was [id]. Some provider-specific context may have been lost in conversion.`\n2. Preserve workspace context: if the source session referenced specific files, include a short orientation blurb.\n3. Add a synthetic summary message of where the original session left off (useful if it ended mid-task).\n4. Include a short conversation summary of the last N messages.\n\nRequirements:\n- Enrichment must be clearly distinguishable from real conversation (metadata flag + obvious prefix) so it does not confuse the target agent.\n- Enrichment must never run by default.\n\n## Acceptance Criteria\n\n- `--enrich` produces deterministic, clearly marked synthetic messages.\n- Enrichment does not break provider-native writer acceptance (covered by round-trip + conformance tests).\n- Enrichment behavior is unit-tested (pipeline tests) and covered in e2e script.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-08T20:45:52.620517770Z","created_by":"ubuntu","updated_at":"2026-02-08T22:54:13.302850956Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["enrichment","pipeline"],"dependencies":[{"issue_id":"bd-ikb.4","depends_on_id":"bd-ikb","type":"parent-child","created_at":"2026-02-08T21:49:14.701343864Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.4","depends_on_id":"bd-ikb.1","type":"blocks","created_at":"2026-02-08T20:45:57.843666923Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb.5","title":"Integration: Wire all providers into registry and run smoke test","description":"This is the full integration convergence task after core readers/writers/pipeline are implemented.\n\nScope:\n1. Build default provider registry wiring for Claude Code, Codex, and Gemini.\n2. Connect registry + conversion pipeline into CLI dispatch paths.\n3. Run full cross-provider integration matrix (all 6 conversion directions):\n   - CC->Codex, CC->Gemini, Codex->CC, Codex->Gemini, Gemini->CC, Gemini->Codex\n4. For each matrix case, assert:\n   - conversion succeeds,\n   - output artifact exists and parses,\n   - resume command is generated correctly,\n   - read-back verification succeeds.\n5. Ensure behavior is graceful when a provider is not installed (registry remains constructable and diagnostics are actionable).\n\nValidation requirements:\n- Emit structured integration logs per path (source, target, session id, output path, timings).\n- Produce artifact bundle on failure (source fixture, generated output, diff/diagnostic summary).\n- Ensure this task unblocks e2e smoke and UX output tasks with confidence.\n\nAcceptance criteria:\n- All six conversion paths pass integration tests in isolated temp homes.\n- Missing-provider scenarios are tested and produce actionable errors.\n- Integration logs and artifacts are sufficiently detailed to debug failures without rerunning interactively.","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-08T21:04:05.421856359Z","created_by":"ubuntu","updated_at":"2026-02-08T22:08:20.730975497Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","integration","pipeline"],"dependencies":[{"issue_id":"bd-ikb.5","depends_on_id":"bd-1a2.1","type":"blocks","created_at":"2026-02-08T21:04:10.957400557Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-1a2.2","type":"blocks","created_at":"2026-02-08T21:04:11.033879732Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-1a2.3","type":"blocks","created_at":"2026-02-08T21:04:11.109976821Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-20x.1","type":"blocks","created_at":"2026-02-08T21:04:10.709016025Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-20x.2","type":"blocks","created_at":"2026-02-08T21:04:10.789237658Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-20x.3","type":"blocks","created_at":"2026-02-08T21:04:10.877036388Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-ikb","type":"parent-child","created_at":"2026-02-08T21:49:07.420902722Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.5","depends_on_id":"bd-ikb.1","type":"blocks","created_at":"2026-02-08T21:04:10.633170758Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-ikb.6","title":"Handle same-provider conversion gracefully","description":"Handle the edge case where the user runs `casr cc resume <claude-session-id>`: converting a session back to the same provider. This is not an error, but it is a special case.\n\nSmart default behavior:\n1. If source and target are the same provider and the session already exists at the expected native path, treat it as a no-op lookup: print resume command and exit.\n2. If source and target are the same provider but the session is in a different location/shape (e.g., non-standard path via `--source`), treat it as a copy operation (read -> canonical -> write) under a new id.\n3. Always print a notice: `Note: source and target are both <Provider>.`\n\nRationale:\n- user doesn't remember which provider a session came from\n- user wants the resume command without conversion\n- user wants to duplicate/move a session inside a provider\n\nImplementation sketch:\n- In `ConversionPipeline::convert()`, detect `source.slug == target.slug` and choose between no-op vs copy depending on whether write is necessary.\n\n## Acceptance Criteria\n\n- Same-provider no-op path produces correct resume command without writes.\n- Same-provider copy path produces a new session artifact under the provider's native store.\n- Behavior is covered by pipeline unit tests (bd-24z.9) and e2e script (bd-24z.6).","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T21:05:10.140744557Z","created_by":"ubuntu","updated_at":"2026-02-08T22:54:01.940201199Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","pipeline"],"dependencies":[{"issue_id":"bd-ikb.6","depends_on_id":"bd-ikb","type":"parent-child","created_at":"2026-02-08T21:49:11.646929414Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-ikb.6","depends_on_id":"bd-ikb.1","type":"blocks","created_at":"2026-02-08T21:05:14.399844997Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
